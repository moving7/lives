dwfis.define("TTR",function(){return window.TT_ROOM_DATA});
;dwfis.define("TTA",function(){return window.TT_PROFILE_INFO});
;dwfis.define("TTPlayer/h5",function(e){var i=e("TTR"),r=e("TTA");return function(e){var n=hyPlayerConfig.WEBYYFROM,o=hyPlayerConfig.vappid;TT.isProd||(o=10060),"2"==i.liveSourceType&&(o=10507);var a={chTopId:i.id,subChId:i.sid,pyyid:r.yyid,deleteOriginalPainting:TT_PLAYER_CFG.deleteOriginalPainting,h5gopChannel:TT_PLAYER_CFG.h5gopChannel,eu:r.lp,rso:parseQueryString(location.href).rso||"",rso_desc:parseQueryString(location.href).rso_desc||"",from:n,vappid:o,gameId:i.gid,screenType:i.screenType,furl:encodeURIComponent(document.referrer),ref:window.HUYA_UTIL&&HUYA_UTIL.getCookieVal("ya_eid"),iSourceType:i.liveSourceType,avatarImg:r.avatar};i.isReplay&&$.extend(a,{replay:1,isEu:!1,doJoin:0}),window.h5loadTime=(new Date).getTime(),$("#liveRoomObj").html('<div id="videoContainer" style="position: relative;"></div>');var d=new VPlayer($.extend({idDom:"#videoContainer",register:function(i){e.emit("reg",i)}},a));e.emit("initComplete",d)}});
;dwfis.define("TTPlayer/flash",function(e){var i=e("TTR"),o=e("TTA");return function(e){function t(e){var i=this;$("#liveRoomObj").html('<div id="flashRoomObj"></div>'),$.extend(!0,this,e),window.initComplete=function(){i.init()},this.load()}var n=hyPlayerConfig.WEBYYFROM,a=hyPlayerConfig.WEBYYSWF,r=(hyPlayerConfig.WEBYYHOST,hyPlayerConfig.vappid),s=TT_PLAYER_CFG.flashDomain+TT_PLAYER_CFG.flashVersion+"/main.swf";"2"==i.liveSourceType&&(r=10507),window.jsTime=(new Date).getTime();var l={topSid:i.id,subSid:i.sid,pyyid:o.yyid,eu:o.lp,type:a,_yyAuth:"12",rso:parseQueryString(location.href).rso||"",rso_desc:parseQueryString(location.href).rso_desc||"",from:n,vappid:r,gameId:i.gid,furl:encodeURIComponent(document.referrer),referer:encodeURIComponent(location.href),ref:window.HUYA_UTIL&&HUYA_UTIL.getCookieVal("ya_eid"),pageFull:1,iSourceType:i.liveSourceType,screenType:i.screenType,normalpub:1,avatarImg:o.avatar};i.isReplay&&$.extend(l,{replay:1,isEu:!1,doJoin:0}),t.prototype={swfPath:"",swfVs:"10.1",swfvar:null,id:"flashRoomObj",swfSetting:{quality:"high",bgcolor:"#000000",allowScriptAccess:"always",allowFullScreen:"true",allowFullScreenInteractive:"true",wmode:"opaque",menu:"false"},type:"flash",load:function(){var i=this;return window.swfobject&&swfobject.hasFlashPlayerVersion(i.swfVs)?(swfobject.embedSWF(i.swfPath,i.id,"100%","100%",i.swfVs,null,i.swfvar,i.swfSetting,{name:i.id},function(i){i&&i.ref&&"onload"in i.ref&&(i.ref.onload=function(){e.emit("load")}),huyacreateObject.apply(this,arguments)},huyaflashCallback),this):this},init:function(){var i=this;i.getMovie().callAs("addJsKey",!0),e.emit("reg",i.getMovie()),e.emit("initComplete",i.getMovie())},getMovie:function(){var e;return function(){return e||(e=$.browser.msie?window[this.id]:document[this.id])}}()},new t({swfPath:s,swfvar:l})}});
;dwfis.define("TTPlayer",function(n){function e(n){return"function"==typeof n}function t(n){return"string"==typeof n}function r(n){var r=new u,o=$.extend({type:d,useHls:!1},n),c=o.type,h=c===f,v=c===d,y=new u;h?s[c](o.useHls,function(){y.emit("load"),i(y)}):v&&s[c](function(){a(y)});var m=function(){var n=$.Deferred();return y.on("load",function(){n.resolve()},!0),function(e){n.done(e)}}();y.on("reg",function(n){if(h)n.on("all",function(){r.emit.apply(r,arguments)});else if(v){var e="TT_PLAYER_FLASH_EVENT_LISTENER_"+Math.floor(1e10*Math.random());window[e]=function(n){try{r.emit(n.jsKey,n)}catch(e){TT.log(e)}};try{n.registerCallBack("all",e)}catch(t){TT.log("flash\u64ad\u653e\u5668\u4e8b\u4ef6\u76d1\u542c\u5931\u8d25\uff01")}}},!0);var p=!1,T=null;y.on("initComplete",function(n){p=!0,T=n},!0);var _=function(){var n=$.Deferred();return y.on("initComplete",function(){n.resolveWith(r,[T])},!0),function(e){return n.done(e),p}}(),g=!1,E=function(){var n=$.Deferred();return r.on("gamelivePubTextInitComplete",function(){g=!0,n.resolveWith(r,[T])},!0),function(e){return n.done(e),g}}(),w=!1,P=function(){var n=$.Deferred();return r.on("videoOnLoad",function(){w=!0,n.resolveWith(r,[T])},!0),function(e){return n.done(e),w}}(),k=function(n,r){if(g&&n&&t(n)){var o;return h?e(T[n])?o=T[n](r):e(T.callByJs)&&(o=T.callByJs(n,r)):v&&(o=T.callAs(n,r)),o}},L=l.once(function(){var n=k("getMyInfo");return n?{uid:n.lUid||n.uid,nick:n.sNick||n.nickname}:null});return $.extend(r,{type:c,isH5:h,isFlash:v,onload:m,initComplete:_,ready:E,videoOnLoad:P,call:k,getMyInfo:L}),r}var o=window.TT_PLAYER_CFG,i=n("TTPlayer/h5"),a=n("TTPlayer/flash"),l=n("tools"),u=n("Event"),c=(Array.prototype.slice,l.lazyLoadScript),f="H5",d="FLASH",s={};return function(){var n=c(o.h5domain+o.h5ver+"/vplayer.js"),e=c(o.h5sdk+"h5player.min."+o.h5sdkver+".js"),t=c(o.h5sdk+o.h5hlssdkver+".js"),r=c(o.h5domain+o.h5ver+"/vplayer_taf.js"),i=c(o.h5domain+o.h5PlayerIncludeSDK+"/vplayer2.js"),a=l.once(function(){var n=document.createElement("link");n.rel="stylesheet",n.href=o.h5domain+o.h5ver+"/vplayer.css",document.getElementsByTagName("head")[0].appendChild(n)});s[f]=function(l,u){a(),l?$.when(r(),t()).then(function(){return n()}).done(u):-1==o.h5PlayerIncludeSDK?$.when(r(),e()).then(function(){return n()}).done(u):i(u)},s[d]=c("//a.msstatic.com/huya/main/lib/swf_hiido_hiidostatic_72ae934.js")}(),r.TYPE_H5=f,r.TYPE_FLASH=d,r});
;dwfis.define("TTP",function(e){function o(){var e=parseQueryString(location.href),o=!!e.playerh5,n=!!e.playerflash,i=function(){var e=navigator.userAgent.toLocaleLowerCase(),o=e.match(/chrome\/([\d.]+)/);return!!(o&&parseInt(o[1],10)>=45&&-1==e.indexOf("edge"))}(),t=function(){var e=(new Date).getTime(),o=localStorage.getItem("h5ErrorTime");return o&&864e5>=e-o?!0:!1}();return o||!n&&hyPlayerConfig.html5&&i&&!t}function n(){var e=!1;/2345chrome/.test(window.navigator.userAgent)?e=!0:/2345Explorer/.test(window.navigator.userAgent)&&(e=!0);try{window.external.RCCoralGetItemCacheType(),e=!0}catch(o){}return e}var i=e("TTR"),t=e("TTPlayer"),a=new t({type:o()&&!n()?t.TYPE_H5:t.TYPE_FLASH,useHls:i.isReplay});return a.isH5&&(a.on("playerError",function(){function e(){if(window.localStorage){var e=(new Date).getTime(),o=localStorage.getItem("h5ErrorTime");if(o&&864e5>=e-o)return!1;localStorage.setItem("h5ErrorTime",e)}}e();var o=window.location.href;o+=o.indexOf("?")>=0?"&playerflash=1":"?playerflash=1",window.location.href=o}),a.onload(function(){!function(){var e={send:function(e){var o=new Image;o.src=e,setTimeout(function(){o=null},200)},getCookie:function(e){var o,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(o=document.cookie.match(n))?unescape(o[2]):null},setCookie:function(e,o,n,i,t){var a=encodeURIComponent(e)+"="+encodeURIComponent(o)+"; domain="+n+"; path="+i;t>0&&(a=a+"; expires="+t.toGMTString()),document.cookie=a},removeCookie:function(e){var o=encodeURIComponent(e)+"=";o+="; expires="+new Date(0)+"; path=/;domain="+TT.domainForWriteCookie,document.cookie=o}};window.h5VideoloadTime=function(){if("undefined"!=typeof performance&&"undefined"!=typeof flashTime&&"undefined"!=typeof reportPageView&&"undefined"!=typeof h5loadTime){var o=window.performance.timing,n=(new Date).getTime(),i={act:window.TT_ROOM_DATA&&TT_ROOM_DATA.isReplay?"webhuyah5performsreplay":"webhuyah5performs",time:parseInt(1*new Date/1e3),uid:e.getCookie("yyuid"),firstByteTime:o.responseStart-o.domainLookupStart,resourcesTime:h5loadTime-flashTime,videoTime:n-h5loadTime,firstScreenTime:n-flashTime,pageview:reportPageView};e.send("//ylog.hiido.com/c.gif?"+$.param(i)),window.TT&&TT.emit("h5VideoloadTime"),window.h5VideoloadTime=function(){}}}}(window)})),a.displayMode=0,a.on("pageFullScreen",function(e){var o=e.param.flag;o!=a.displayMode&&a.emit("displayModeChange",a.displayMode=o)}),function(){function e(){function e(){window.ya?a.call("tongjiReady",{sessionId:YA.session_id.get(),mid:YA.mid.get()}):setTimeout(e,1e3)}e()}a.isFlash&&a.on("flashTongJiInit",function(){a.ready(e)}),a.isH5&&a.ready(e)}(),a.videoOnLoad(function(){i.isOn&&window.h5VideoloadTime&&h5VideoloadTime()}),window.TTP=a});
;dwfis.define("Emot",function(){function e(e){$.extend(this,{faces:o},e),this.onSelectedCallbacks=$.Callbacks(),this.view=$(this.tpl()),this.bind()}var o=[{key:"dx",code:"/{dx"},{key:"pz",code:"/{pz"},{key:"fn",code:"/{fn"},{key:"tp",code:"/{tp"},{key:"jy",code:"/{jy"},{key:"ot",code:"/{ot"},{key:"ng",code:"/{ng"},{key:"hk",code:"/{hk"},{key:"kz",code:"/{kz"},{key:"wx",code:"/{wx"},{key:"se",code:"/{se"},{key:"tx",code:"/{tx"},{key:"lh",code:"/{lh"},{key:"hp",code:"/{hp"},{key:"am",code:"/{am"},{key:"kun",code:"/{kun"},{key:"by",code:"/{by"},{key:"ka",code:"/{ka"},{key:"cy",code:"/{cy"},{key:"kx",code:"/{kx"},{key:"ll",code:"/{ll"},{key:"fd",code:"/{fd"},{key:"yw",code:"/{yw"},{key:"xu",code:"/{xu"},{key:"yun",code:"/{yun"},{key:"zs",code:"/{zs"},{key:"88",code:"/{88"},{key:"qd",code:"/{qd"},{key:"kl",code:"/{kl"},{key:"dy",code:"/{dy"},{key:"hx",code:"/{hx"},{key:"bz",code:"/{bz"},{key:"yb",code:"/{yb"},{key:"dai",code:"/{dai"},{key:"sj",code:"/{sj"},{key:"zt",code:"/{zt"},{key:"gz",code:"/{gz"},{key:"qq",code:"/{qq"},{key:"kb",code:"/{kb"},{key:"wq",code:"/{wq"},{key:"yx",code:"/{yx"},{key:"kel",code:"/{kel"},{key:"bs",code:"/{bs"},{key:"zk",code:"/{zk"},{key:"bq",code:"/{bq"},{key:"ok",code:"/{ok"},{key:"zan",code:"/{zan"},{key:"ruo",code:"/{ruo"},{key:"ws",code:"/{ws"},{key:"sl",code:"/{sl"},{key:"mg",code:"/{mg"},{key:"kw",code:"/{kw"},{key:"wen",code:"/{wen"},{key:"xd",code:"/{xd"},{key:"xs",code:"/{xs"},{key:"lw",code:"/{lw"},{key:"sd",code:"/{sd"},{key:"zd",code:"/{zd"},{key:"dao",code:"/{dao"},{key:"cc",code:"/{cc"}],c={},t=[];$.each(o,function(e,o){o.img="other/"+o.key+".gif",c[o.key]=o,t.push(o.key)});var d=new RegExp("/{("+t.join("|")+")","g"),k=function(e,o){return e.replace(d,function(e,t){return o(c[t])})},n=function(e){return e=e||"",k(e,function(e){return'<img src="'+e.img+'" alt="'+e.code+'" />'})},y=function(){var e="localStorage"in window,o=$.Callbacks(),c="huya_emot_history",t=[],d=function(){if(e){var o=localStorage.getItem(c);t=o?$.parseJSON(o):[]}},k=function(){return[].concat(t)};return d(),e&&window.addEventListener&&window.addEventListener("storage",function(){var e=null;return function(t){e&&clearTimeout(e),e=setTimeout(function(){(null===t.newValue||t.key===c)&&(d(),o.fire(k()))},200)}}()),{add:function(d){if($.each(t,function(e,o){return d===o?(t.splice(e,1),!1):void 0}),t.unshift(d),e){var n='["'+t.join('","')+'"]';localStorage.setItem(c,n)}o.fire(k())},get:k,change:function(e){o.add(e)}}}();return e.prototype={tpl:function(){for(var e=[],o=null,c=0,t=this.faces.length;t>c;c++)o=this.faces[c],e.push(o?'<li class="emot-item J_emotItem" data-key="'+o.key+'"><img src="other/'+o.key+'.gif" alt="'+o.code+'" /><i></i></li>':'<li class="emot-item J_emotItem"></li>');var d=['<div class="emot-panel">','<ul class="emot-list">',e.join(""),"</ul>","</div>"];return d.join("")},bind:function(){var e=this;this.view.on("click.emot",".J_emotItem",function(o){o.preventDefault();var t=$(this).data("key"),d=c[t];d&&(y.add(d.key),e.onSelectedCallbacks.fireWith(this,[d]))})},select:function(e){this.onSelectedCallbacks.add(e)}},e.faces=o,e.faceMap=c,e.parse=k,e.replace=n,e.history=y,e});
;dwfis.define("chatScroll",function(){function o(){this.initialize.apply(this,arguments)}return o.prototype={version:"1.0.0",constructor:o,initialize:function(o){this.waterfall=o.waterfall,this.waterfall_list=o.waterfall_list,this.scroll_bar=o.scroll_bar,this.scroll_move=o.scroll_move,this.scroll_move_minH=o.scroll_move_minH||20,this.maintainPosition=o.maintainPosition||!1,this.scrollFn=o.scrollFn||function(){},this.scrollMoveSpeed=9,this.setRealHeight(),this._bindEvent()},_bindEvent:function(){this._moveBar(),this._mouseScroll()},scrollToTop:function(){this.waterfall.scrollTop(0)},scrollToBottom:function(o,t){this.waterfall.scrollTop(t-o)},setRealHeight:function(o){var t,l,s,i=!1;t=this.waterfall.height(),l=this.waterfall_list.height(),s=t/l,0==this.maintainPosition&&this.scrollToBottom(t,l);var e=this.waterfall.scrollTop(),r=e/(l-t);if(s>0&&1>s){var n=parseInt(s*t)<=this.scroll_move_minH?this.scroll_move_minH:parseInt(s*t),a=this.scroll_bar.height();this.maxL=a-n,this.scroll_move[0].style.display="block",this.scroll_move[0].style.height=n+"px",this.scroll_move[0].style.top=r*this.maxL+"px",r*this.maxL+n==a&&(i=!0),o&&o(i)}else this.scroll_move[0].style.display="none"},_moveBar:function(){var o,t,l=this;$(".scroll_move").on("mousedown",function(s){return o=s.pageY-parseInt($(this).css("top")),$(document).on("mousemove.scroll_move",function(s){return t=s.pageY-o,0>t&&(t=0),t>l.maxL&&(t=l.maxL),l.setPosition(t),!1}),$(document).on("mouseup",function(){$(document).off("mousemove.scroll_move").off("mouseup.scroll_move")}),!1})},_mouseScroll:function(){var o=this;o.waterfall.on("mousewheel",function(t,l){var s=o.scroll_move.position().top;return s=0>l?s+o.scrollMoveSpeed>o.maxL?o.maxL:s+o.scrollMoveSpeed:s-o.scrollMoveSpeed<o.scrollMoveSpeed?0:s-o.scrollMoveSpeed,o.setPosition(s),!1})},setPosition:function(o){if("block"==this.scroll_move[0].style.display){var t=parseInt(o/this.maxL*(this.waterfall_list.height()-this.waterfall.height())),l=!1;this.waterfall.scrollTop(t),this.scroll_move.css({top:o}),o==this.maxL&&(l=!0),this.scrollFn(l)}}},o});
;dwfis.define("auditor",function(e,i,t){function n(e,i){r.isH5?r.ready(function(t){t.addTafListener("muteRoomUser",function(e){i(e),t.removeTafListener("muteRoomUser")});var n=new HUYA.MuteRoomUserReq;n.tId=t.userId,t.sendWup("liveui","muteRoomUser",$.extend(n,e))}):(r.on("silenceResp",function(e){i(e),r.off("silenceResp")}),r.ready(function(i){i.callAs("js2muteRoomUser",e)}))}function a(e,i,t,a){function s(i){try{n({lUid:e,sText:t,lPresenterUid:p.lp,lSubcid:u.sid,iMutedTime:i,iMutedAction:a},function(e){e=e.param?e.param:e,0==e.iRetCode?f.suc("\u64cd\u4f5c\u6210\u529f",e.sMsg):f.err("\u64cd\u4f5c\u5931\u8d25",e.sMsg)})}catch(s){}try{ya.reportProductEvent({eid:"click/zhibo/gp/qdjy",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u786e\u5b9a"+o})}catch(s){}}i=HUYA_UTIL.xssFilter(i);var o=0==a?"\u7981\u8a00":2==a?"\u5c01\u7981IP":"\u5c01\u7981";t=t||"";f({title:"\u8bf7\u786e\u8ba4",width:320,content:['<div class="silence_dialog">','<p class="tit">\u4f60\u8981\u5c06 <em>\u201c'+i+"\u201d</em> "+o+"\u591a\u4e45\uff1f</p>",t?'<p class="excerpt">'+i+"\uff1a"+t+"</p>":"",'<div class="time">','<label><input type="radio" name="silence_time" value="0.5" checked /> 30\u5206\u949f</label>','<label><input type="radio" name="silence_time" value="24" /> 1\u5929</label>','<label><input type="radio" name="silence_time" value="72" /> 3\u5929</label>','<label><input type="radio" name="silence_time" value="168" /> 7\u5929</label>',"</div>","</div>"].join(""),buttons:[{name:"\u786e\u5b9a",click:function(){var e=this.view.find("input:checked").val();e&&s(60*e*60)}},{name:"\u53d6\u6d88",click:function(){}}]})}function s(e,i,t){function a(i,a,s){try{n({lUid:e,sText:t,lPresenterUid:p.lp,lSubcid:u.sid,iMutedTime:i,iMutedAction:1,iReasonType:a,sReason:s},function(e){e=e.param?e.param:e,0==e.iRetCode?f.suc("\u64cd\u4f5c\u6210\u529f",e.sMsg):f.err("\u64cd\u4f5c\u5931\u8d25",e.sMsg)})}catch(o){}try{ya.reportProductEvent({eid:"click/zhibo/gp/qdfr",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u786e\u5b9a\u5c01\u5165"})}catch(o){}}i=HUYA_UTIL.xssFilter(i),t=t||"";f({title:"\u8bf7\u786e\u8ba4",width:320,content:['<div class="silence_addToBlacklist">','<p class="tit">\u4f60\u771f\u7684\u8981\u5c06 <em>\u201c'+i+"\u201d</em> \u5c01\u5165\u9ed1\u540d\u5355\uff1f</p>",t?'<p class="excerpt">'+i+"\uff1a"+t+"</p>":"",'<div class="time">','<label><input type="radio" name="silence_time" value="0.5" checked /> 30\u5206\u949f</label>','<label><input type="radio" name="silence_time" value="24" /> 1\u5929</label>','<label><input type="radio" name="silence_time" value="72" /> 3\u5929</label>','<label><input type="radio" name="silence_time" value="168" /> 7\u5929</label>',"</div>",'<div class="cause">',"<span>\u5c01\u4eba\u7406\u7531: </span>",'<select id="J_dlgAddToBackListCause">','<option value="1">\u6076\u610f\u5237\u5c4f</option>','<option value="2">\u8c29\u9a82</option>','<option value="3">\u5237\u5e7f\u544a</option>','<option value="4">\u5176\u4ed6</option>',"</select>",'<textarea id="J_dlgAddToBackListCauseText" placeholder="30\u4e2a\u5b57\u4ee5\u5185" maxlength="30"></textarea>',"</div>",'<p class="ps">\u5907\u6ce8\uff1a\u5c01\u5165\u9ed1\u540d\u5355\u540e\uff0c\u7528\u6237\u7684\u4e00\u5207\u4e92\u52a8\u884c\u4e3a\u5c06\u88ab\u7981\u6b62\u3002</p>',"</div>"].join(""),init:function(){var e=$("#J_dlgAddToBackListCauseText");$("#J_dlgAddToBackListCause")[0].onchange=function(){4==this.value?e.show():e.hide()}},buttons:[{name:"\u786e\u5b9a",close:!1,click:function(){var e=this.view.find("input:checked").val(),i=$("#J_dlgAddToBackListCause").val();i=parseInt(i,10);var t="",n=$("#J_dlgAddToBackListCauseText");return 4!=i||(t=n.val())?(a(60*e*60,i,t),void this.close()):void alert("\u5c01\u4eba\u7406\u7531\u4e0d\u80fd\u4e3a\u7a7a")}},{name:"\u53d6\u6d88",click:function(){}}]})}function o(e){var i=e.param?e.param.data:e;NAV_UTIL.getUserInfo()&&i.lUid==NAV_UTIL.getUserInfo().yyID&&v.resolve(i.iUserType,i)}function l(e){var i=e.param?e.param.data:e;i.bPopUp&&m.add('<div class="sysMsg"><i></i><em>\u7cfb\u7edf\u6d88\u606f\uff1a</em><span>'+i.sSystemTips+"</span></div>"),NAV_UTIL.getUserInfo()&&i.lUid==NAV_UTIL.getUserInfo().yyID&&T.fire(i.iNewUserType,i)}var d,c,r=e("TTP"),u=e("TTR"),p=e("TTA"),m=e("msgManager"),f=e("dialog").dialog,v=$.Deferred(),T=$.Callbacks();v.done(function(e){d=2===e,c=1===e}),T.add(function(e){d=2===e,c=1===e}),r.isH5?r.ready(function(e){e.addTafListener("10040",o)}):r.on("onAuditorEnter",o),r.isH5?r.ready(function(e){e.addTafListener("10041",l)}):r.on("onAuditorRoleChange",l);var y={onEnter:function(e){v.done(e)},change:function(e){T.add(e)},isAuditor:function(){return d},isSuperAuditor:function(){return c},mute:function(e,i,t){(d||c)&&a(e,i,t,0)},banIP:function(e,i,t){c&&a(e,i,t,2)},banUser:function(e,i,t){(d||c)&&s(e,i,t)}};t.exports=y});
;dwfis.define("msgManager",function(n){var t=n("tools"),e=n("Event"),r=Array.prototype.map||function(n){for(var t=[],e=0,r=this.length;r>e;e++)t.push(n(this[e],e));return t},o=Array.prototype.indexOf||function(n){for(var t=0,e=this.length;e>t;t++)if(this[t]===n)return t;return-1},i=function(){},l=function(){function n(n){null===v&&(v=document.createElement("ul")),v.innerHTML=n;for(var t=[],e=0,r=v.children.length;r>e;e++)t[e]=v.children[e];return t}function l(n,t,e){var r=-1;if(n)if(-1==n.indexOf("</li>")){r=y++;var o={id:r,content:n,data:t,init:"function"==typeof e?e:i,elm:null};T.push(o),p.emit("add",o)}else TT.log('%cThe "content" can not contain tag "li"\uff01',"color:red");return r}function c(n){for(var t=0,e=_.length;e>t;t++)if(_[t].id==n)return _[t];return null}function u(n){var t=c(n);return t&&f(o.call(_,t),1),t}function a(){var n=0,t=document.createDocumentFragment();return{add:function(e){t.appendChild(e),++n>=300&&(t=document.createDocumentFragment(),n=0)}}}function f(n,t){var e=_.splice(n,t);if(e.length>0){null===w&&(w=new a);for(var r=0,o=e.length;o>r;r++)w.add(e[r].elm);p.emit("del",e)}return e}function d(n){n&&(T=[]),p.emit("cls",f(0,_.length),!!n)}function m(){x=!1}function h(){x=!0}function g(){var n=_.length-100,t=n>0;x&&t&&p.emit("gc",f(0,n))}function s(){if(!(T.length<=0)){var t=r.call(T,function(n){return'<li class="J_msg" data-id="'+n.id+'">'+n.content+"</li>"});null===D&&(D=document.createDocumentFragment());for(var e=n(t.join("")),o=0,i=e.length;i>o;o++)T[o].elm=e[o],T[o].init(e[o],T[o]),D.appendChild(e[o]);var l=T;_=_.concat(l),T=[],null===C&&(C=document.getElementById("chat-room__list")),C.appendChild(D),g(),p.emit("nextTick"),p.off("nextTick"),p.emit("msg",l)}}var p=new e,v=null,y=0,T=[],_=[],w=null,x=!0,C=null,D=null;p.on("add",t.throttle(s,200));var E=t.throttle(l,200),F=l;return TTP.on("displayModeChange",function(n){1==n||2==n?(T=[],F=E):(F.cancel&&F.cancel(),F=l)}),{gc_close:m,gc_open:h,add:function(){F.apply(this,arguments)},get:c,remove:u,clear:d,size:function(){return _.length},on:p.on,one:p.one,off:p.off}};return new l});
;dwfis.define("chatRoom/scrollbar",function(i){var t=i("TTP"),o=i("msgManager"),n=i("tools"),e=i("chatScroll"),c={api:null,moreMsg:$("#more-msg"),locked:!1,lock:function(){var i=this;this.locked=!0,o.gc_close(),this.lockBtn.addClass("locked").find("span").text("\u89e3\u9501"),this.api.maintainPosition=!0,this.api.setRealHeight(function(t){t?i.moreMsg.hide():i.moreMsg.show()}),this.autoUnlock()},unlock:function(){var i=this;this.autoUnlockTimer&&clearTimeout(this.autoUnlockTimer),this.locked=!1,o.gc_open(),this.lockBtn.removeClass("locked").find("span").text("\u9501\u5c4f"),this.api.maintainPosition=!1,this.api.setRealHeight(function(t){t?i.moreMsg.hide():i.moreMsg.show()})},autoUnlock:function(){var i=this;i.locked&&(i.autoUnlockTimer&&clearTimeout(i.autoUnlockTimer),i.autoUnlockTimer=setTimeout(function(){i.unlock()},15e3))},lockBtn:$('<p class="lockBtn"><i></i><span>\u9501\u5c4f</span></p>'),clearBtn:$('<p class="clearBtn"><i></i><span>\u6e05\u5c4f</span></p>'),reinit:function(){var i=this;this.api.maintainPosition=this.locked,this.api.setRealHeight(function(t){t?i.moreMsg.hide():i.moreMsg.show()})},init:function(){var i=this;i.api=new e({waterfall:$("#chat-room__wrap"),waterfall_list:$("#chat-room__list"),scroll_bar:$(".scroll_bar"),scroll_move:$(".scroll_move"),scrollFn:function(t){t?(i.unlock(),i.moreMsg.hide()):(i.lock(),i.moreMsg.show())}}),i.lockBtn.on("click",function(t){t.preventDefault();var o=i.locked;o?i.unlock():i.lock();try{ya.reportProductEvent({eid:"click/zhibo/gp/"+(o?"unlock":"lock"),eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/"+(o?"\u89e3\u9501":"\u9501\u5c4f")})}catch(t){}}),i.clearBtn.on("click",function(t){t.preventDefault(),o.clear(),i.unlock();try{ya.reportProductEvent({eid:"click/zhibo/gp/cls",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u6e05\u5c4f"})}catch(t){}}),$("#watchChat_pub").append(i.lockBtn).append(i.clearBtn);var t=null;DUYA_SUB.subscribe("resizeWide",function(){t&&clearTimeout(t),t=setTimeout(function(){i.reinit()},100)}),DUYA_SUB.subscribe("resizereinitialise",function(){i.reinit()}),this.moreMsg.on("click",function(t){t.preventDefault(),i.unlock()})}};return t.ready(function(){c.init();var i=n.throttle(function(){c.reinit()},120);o.on("msg",i),o.on("cls",i)}),c});
;dwfis.define("chatRoom/useUcard",function(e){var t=e("msgManager"),i=e("chatRoom/scrollbar"),o=e("dialog").layer,n=e("widget/ucard"),a=e("tools"),c=null,d=null,l=function(){c&&c.close(),d=c=null},r=function(e,t){d&&d.lUid==e||n({uid:e,muteText:t,init:function(e){c&&c.close(),d=e.data,c=o({view:e.view,zIndex:199,lock:!1,container:".room-sidebar"}),$(window).resize(a.debounce(function(){c&&c.center()},60))},close:l,destroy:l})};$(".room-sidebar").on("click",function(e){c&&c.view[0]!==e.target&&!c.view.find(e.target).length&&l()}),$("#chat-room__list").on("click",".J_userMenu",function(e){e.preventDefault(),i.lock();var o=$(this),n=o.closest("[data-id]").data("id"),a=n?t.get(n):null;if(a&&a.data){r(a.data.uid,a.data.msg);try{ya.reportProductEvent({eid:"click/zhibo/gp/yhm",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u7528\u6237\u540d"})}catch(e){}}})});
;dwfis.define("chatRoom",function(e){var o=e("TTP"),n=e("TTA"),i=e("msgManager"),t={},a=e("chatRoom/scrollbar");t.scrollbar=a,i.add('<p style="color:#3c0; padding: 5px 9px;">\u7cfb\u7edf\u6d88\u606f : \u864e\u7259\u5b98\u65b9\u5021\u5bfc\u7eff\u8272\u76f4\u64ad\uff0c\u5bf9\u76f4\u64ad\u5185\u5bb9\u8fdb\u884c24\u5c0f\u65f6\u5728\u7ebf\u5de1\u67e5\u3002\u4efb\u4f55\u4f20\u64ad\u8fdd\u6cd5\u3001\u8fdd\u89c4\u3001\u4f4e\u4fd7\u3001\u66b4\u529b\u7b49\u4e0d\u826f\u4fe1\u606f\u7684\u884c\u4e3a\u5c06\u4f1a\u5c01\u505c\u8d26\u53f7\u3002\u5207\u52ff\u4e0e\u4ed6\u4eba\u79c1\u4e0b\u4ea4\u6613\u8f6c\u8d26\uff0c\u4ee5\u514d\u4e0a\u5f53\u53d7\u9a97\u3002</p>'),function(){function e(e){var o=e.param?e.param:e;$("#watchChat_pub").css("background-image","url("+TT.trimUrl(o.data.sWebPicUrl)+")")}function i(){$("#watchChat_pub").css("background-image","")}o.isH5?o.ready(function(o){o.addTafListener("getScreenSkin",function(n){0==n.iRetCode&&e(n),o.removeTafListener("getScreenSkin")});var t=new HUYA.getScreenSkinReq;t.tId=o.userId,t.lPresenterUid=n.lp,t.iTemplate=0,t.iFromType=5,o.sendWup("liveui","getScreenSkin",t),o.addTafListener("6640",e),o.addTafListener("6641",i)}):(o.on("showScreenSkinNotify",e),o.on("hideScreenSkinNotify",i))}(),e("chatRoom/useUcard");var c,r=e("widget/fansBadgeAnchor"),s={close:function(){}};$("#chat-room__list").on("mouseenter",".fans-icon",function(){var e=$(this),o=e.data("id");if(o&&o!=c){s.close(),c=o;var n,i=e.offset(),t=$(window).scrollLeft()+i.left+e.outerWidth()/2,a=$(window).scrollTop()+i.top+e.outerHeight();r({uid:o,init:function(i){if(o==c){var r=$("<div></div>").css({paddingTop:30,top:a-30+5,left:t-18,zIndex:10,position:"absolute"});s={close:function(){i.close(),r.remove(),e.off("mouseleave"),c=void 0,this.close=function(){}}},e.on("mouseleave",function(){n=setTimeout(function(){s.close()},100)}),r.on("mouseleave",function(){s.close()}).on("mouseenter",function(){clearTimeout(n)}),r.append(i.view),r.appendTo("body")}}})}})});
;dwfis.define("chat/speaker",function(e){var i=e("TTP"),n=e("TTR"),r=e("widget/fansbadge"),t=n.isOn,a=n.isReplay,o=n.isOff,f=null,u=new $.Callbacks,c=new $.Deferred;return i.ready(function(e){function n(e){e=e.param?e.param:e,i.getMyInfo()&&i.getMyInfo().uid==e.tUserInfo.lUid&&(f=e,"resolved"!==c.state()?c.resolve(f):u.fire(f))}t&&(i.isH5?e.addTafListener("1400",n):i.on("onSpeakMessage",n)),a&&(i.isH5?(n({vDecorationPrefix:{value:[]},vDecorationSuffix:{value:[]},tBulletFormat:{iFontColor:-1},tFormat:{iFontColor:0},tUserInfo:{lUid:i.getMyInfo().uid,sNickName:i.getMyInfo().nick}}),e.addTafListener("1400",n)):i.on("onSpeakMessage",n)),o&&n({vDecorationPrefix:{value:[]},vDecorationSuffix:{value:[]},tBulletFormat:{iFontColor:-1},tFormat:{iFontColor:0},tUserInfo:{lUid:i.getMyInfo().uid,sNickName:i.getMyInfo().nick}})}),c.done(function(){r.ready(function(e){if(e.current()){var i=!1;$.each(f.vDecorationPrefix.value,function(n,r){return r&&0==r.iViewType&&10400==r.iAppId?(i=!0,r.vData=e.current(),!1):void 0}),i||f.vDecorationPrefix.value.push({iViewType:0,iAppId:10400,vData:e.current()}),u.fire(f)}e.onUse(function(){var i=f.vDecorationPrefix.value,n=!1;$.each(i,function(r,t){if(e.current()){if(t&&0==t.iViewType&&10400==t.iAppId)return t.vData=e.current(),n=!0,!1}else if(t&&0==t.iViewType&&10400==t.iAppId)return i.splice(r,1),!1}),e.current()&&!n&&f.vDecorationPrefix.value.push({iViewType:0,iAppId:10400,vData:e.current()}),u.fire(f)}),e.onChange(function(e,i){if(i&&e.iBadgeLevelChanged){var n=f.vDecorationPrefix.value;$.each(n,function(i,n){return n&&0==n.iViewType&&10400==n.iAppId?(n.vData=e.tBadgeInfo,!1):void 0}),u.fire(f)}})})}),{ready:function(e){c.done(e)},change:function(e){u.add(e)},getInfo:function(){return f}}});
;dwfis.define("chat/barrageColor",function(t,o,e){function r(t){if(-1==n.get()&&t&&t.tBulletFormat&&-1!=t.tBulletFormat.iFontColor){var o=a.toRgb(t.tBulletFormat.iFontColor);o&&g.set("#"+o.toLowerCase())}}var a=t("tools"),f=t("DefineValue"),l=t("chat/speaker"),n=new f(-1),g=new f("#ffffff");l.ready(r),l.change(r),e.exports={customColor:n,defaultColor:g,get:function(){-1===n.get()?g.get():"#"+a.toRgb(n.get()).toLowerCase()}}});
;dwfis.define("chat/barrageColorFans",function(e,o,a){function r(e){var o=e.color,a=e.grade,r=e.badge,t=e.anchorBadge,n=$("#J-room-color-box"),l=$("#J-color-list-fans"),i=function(){var e=r.current()&&r.current().lBadgeId==c.lp?a.get():-1,o="";$.each(s,function(a,r){o+='<li class="color-item'+(a>e?" locked":"")+("#ffffff"==r?" color-item1":"")+'" style="background-color:'+r+';"></li>'}),l.html(o)},u=function(){function e(a){function i(){r.current()&&r.current().lBadgeId==c.lp&&(e.clear(),localStorage.removeItem(o),t=!1)}var s=$("#J-room-chat-color"),d=l.find(".color-item").eq(a);s.html("<span>\u65b0</span>"),d.html('<span style="position: absolute;width: 25px;height: 20px;color: #fff;background-color: #f50;text-align: center;line-height: 20px;border-radius: 10px; top: -7px;right: -10px; z-index:2">\u65b0</span>'),n.one("mouseleave",i),d.on("mouseenter",i)}var o="ROOM_CHAT_BARRAGE_COLOR_NEW_"+c.lp;a.change(function(a){localStorage.setItem(o,1),t=!0,r.current()&&r.current().lBadgeId==c.lp&&(l.find(".color-item").each(function(e,o){$(o)[e>a?"addClass":"removeClass"]("locked")}),e(a))});var t=!!localStorage.getItem(o);t&&r.current()&&r.current().lBadgeId==c.lp&&e(a.get()),e.clear=function(){$("#J-room-chat-color").html(""),l.find(".color-item").eq(a.get()).html("")},r.onUse(function(o){var r=!(!o||o.lBadgeId!=c.lp),n=r?a.get():-1;l.find(".color-item").each(function(e,o){$(o)[e>n?"addClass":"removeClass"]("locked")}),r?t&&e(a.get()):e.clear()})},g=function(){function e(e,o){var a=$('<div class="color-grade-tip common-panel-tip">'+e+"</div>");a.css({left:o.left,top:o.top-25}),n.append(a)}l.on("mouseenter",".color-item",function(){var o=$(this),a=o.index();if(o.hasClass("locked")){var n="";if(t.sBadgeName){var c=!!r.getItem(t.lBadgeId);n=c?r.current()&&r.current().lBadgeId==t.lBadgeId?"\u9700\u8981\u62e5\u6709\u3010"+t.sBadgeName+'\u3011\u5fbd\u7ae0<span class="tip-mark">'+f[a]+"\u7ea7</span>":"\u8bf7\u6234\u4e0a\u60a8\u7684\u3010"+t.sBadgeName+"\u3011\u5fbd\u7ae0":"\u9700\u8981\u62e5\u6709\u3010"+t.sBadgeName+'\u3011\u5fbd\u7ae0<span class="tip-mark">'+f[a]+"\u7ea7</span>"}else n="\u4e3b\u64ad\u6682\u672a\u5f00\u901a\u7c89\u4e1d\u5fbd\u7ae0";e(n,o.position())}}).on("mouseleave",".color-item",function(){e.clear()}).on("click",".color-item",function(){var e=$(this),a=e.index();if(!e.hasClass("locked")&&!e.hasClass("current")){o.set(d[a]);try{ya.reportProductEvent({eid:"click/room/chatColor/"+a,eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u5f39\u5e55\u989c\u8272/"+d[a]})}catch(r){}}}),e.clear=function(){$(".color-grade-tip").remove()}},m=function(e){var o=_.indexOf(d,e),a=s[o];-1!=o?(l.find(".color-item").removeClass("current").eq(o).addClass("current"),$("#J-room-chat-color").css("background-color","#ffffff"==a?"#aeaeae":a)):l.find(".color-item").removeClass("current")};i(),u(),m(o.get()),o.change(m),g()}function t(){i.ready(function(e,o){var a=e.getItem(c.lp),t=new n(u(a?a.iBadgeLevel:0));e.onChange(function(e){e.tBadgeInfo.lBadgeId==c.lp&&t.set(u(e.tBadgeInfo.iBadgeLevel))});new r({color:l.customColor,grade:t,badge:e,anchorBadge:o})})}var n=(e("tools"),e("DefineValue")),c=e("TTA"),l=e("chat/barrageColor"),i=e("widget/fansbadge"),s=["#ccff66","#33ffff","#ff6699","#ff66ff"],d=$.map(s,function(e){return parseInt(e.slice(1),16)}),f=[6,10,14,21],u=function(e){var o=-1;if($.isNumeric(e)){e=parseInt(e,10);for(var a=0,r=f.length;r>a&&e>=f[a];a++)o=a}return o};a.exports={createPalette:t}});
;dwfis.define("chat/barrageColorLevel",function(o,e,t){function r(o){var e=o.color,t=o.grade,r=$("#J-room-color-box"),c=$("#J-color-list-level"),n=function(){var o=t.get(),e="";$.each(i,function(t,r){e+='<li class="color-item'+(t>o?" locked":"")+("#ffffff"==r?" color-item1":"")+'" style="background-color:'+r+';"></li>'}),c.html(e)},a=function(){function o(o){localStorage.setItem(e,1);var t=$("#J-room-chat-color"),n=c.find(".color-item").eq(o);t.html("<span>\u65b0</span>"),n.html('<span style="position: absolute;width: 25px;height: 20px;color: #fff;background-color: #f50;text-align: center;line-height: 20px;border-radius: 10px; top: -7px;right: -10px; z-index:2">\u65b0</span>'),r.one("mouseleave",function(){n.html(""),localStorage.removeItem(e)}),n.on("mouseenter",function(){n.html(""),localStorage.removeItem(e)})}t.change(function(e){c.find(".color-item").each(function(o,t){e>=o&&$(t).removeClass("locked")}),o(e)});var e="ROOM_CHAT_BARRAGE_COLOR_NEW",n=!!localStorage.getItem(e);n&&o(t.get()),l.defaultColor.change(function(o){c.find(".color-item").eq(0).css("backgroundColor",o)["#ffffff"==o?"addClass":"removeClass"]("color-item1"),0==c.find(".color-item.current").index()&&$("#J-room-chat-color").css("background-color","#ffffff"==o?"#aeaeae":o)})},u=function(){function o(o,e){var t=$('<div class="color-grade-tip common-panel-tip">'+o+"</div>");t.css({left:e.left,top:e.top-25}),r.append(t)}c.on("mouseenter",".color-item",function(){var e=$(this),t=e.index();if(0==t&&o("\u9ed8\u8ba4\u989c\u8272",e.position()),e.hasClass("locked")){var r='\u9700\u8981\u864e\u7259\u7b49\u7ea7<span class="tip-mark">'+s[t]+"\u7ea7</span>";o(r,e.position())}}).on("mouseleave",".color-item",function(){o.clear()}).on("click",".color-item",function(){var o=$(this),t=o.index();if(!o.hasClass("locked")&&!o.hasClass("current")){e.set(f[t]);try{ya.reportProductEvent({eid:"click/room/chatColor/"+t,eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u5f39\u5e55\u989c\u8272/"+f[t]})}catch(r){}}}),o.clear=function(){$(".color-grade-tip").remove()}},d=function(o){var e=_.indexOf(f,o),t=i[e];-1!=e?(c.find(".color-item").removeClass("current").eq(e).addClass("current"),$("#J-room-chat-color").css("background-color","#ffffff"==t?"#aeaeae":t)):c.find(".color-item").removeClass("current")};n(),a(),d(e.get()),e.change(d),u()}function c(){a.get(function(o){var e=new n(u(o));a.change(function(o){var t=u(o);t!==e.get()&&e.set(t)});new r({color:l.customColor,grade:e})})}var n=(o("tools"),o("DefineValue")),a=o("widget/userLevel"),l=(o("chat/speaker"),o("chat/barrageColor")),i=[l.defaultColor.get(),"#66ff99","#33ffcc","#33ccff","#ff3333","#ff3366"],f=$.map(i,function(o,e){return 0===e?-1:parseInt(o.slice(1),16)}),s=[0,6,11,16,21,26],u=function(o){var e=0;if($.isNumeric(o)){o=parseInt(o,10);for(var t=0,r=s.length;r>t&&o>=s[t];t++)e=t}return e};l.defaultColor.change(function(o){i[0]=o}),t.exports={createPalette:c}});
;dwfis.define("chat/barragePosition",function(e,t,n){function o(e){function t(){var e=[1,3,2],t=["\u6b63\u5e38","\u9876\u90e8","\u5e95\u90e8"],n="";$.each(a,function(o){n+='<li class="room-select-item room-select-item'+e[o]+'">',n+='<div class="room-select-pic"></div><span class="room-select-text">'+t[o]+"</span>",n+="</li>"}),l.html(n)}function n(){l.on("click",".room-select-item",function(e){e.preventDefault();var t=$(this).index();if(s.get()>=t&&c.get()!=a[t]){c.set(a[t]);try{ya.reportProductEvent({eid:"click/room/chatPos/"+t,eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u5f39\u5e55\u4f4d\u7f6e/"+a[t]})}catch(e){}}}).on("mouseenter",".room-select-item",function(){var e=$(this).index();e>s.get()&&o(r[e],$(this).position())}).on("mouseleave",".room-select-item",function(){o.clear()})}function o(e,t){var n=$('<div class="font-grade-tip common-panel-tip"><span class="tip-mark">'+e+"\u7ea7</span>\u89e3\u9501</div>");n.css({left:t.left-10,top:t.top-35}),$("#J-room-speaking-box").append(n)}function i(e){l.find(".room-select-item").removeClass("on").eq(_.indexOf(a,e)).addClass("on")}var c=e.pos,s=e.grade,l=$(".room-select-list");o.clear=function(){$(".font-grade-tip").remove()},t(),n(),i(c.get()),c.change(i)}function i(){s.get(function(e){var t=new c(l(e));s.change(function(e){var n=l(e);n!==t.get()&&t.set(n)});new o({pos:f,grade:t})})}var c=(e("tools"),e("DefineValue")),s=e("widget/userLevel"),a=[1,3,2],r=[0,25,30],l=function(e){var t=0;if($.isNumeric(e)){e=parseInt(e,10);for(var n=0,o=r.length;o>n&&e>=r[n];n++)t=n}return t},f=new c(a[0]);n.exports={get:f.get,change:f.change,createPalette:i}});
;dwfis.define("chat/barrageSize",function(e,t,n){function o(e){function t(){var e="";$.each(c,function(t){e+='<li class="room-font-item room-font-item'+(t+1)+'"></li>'}),s.html(e)}function n(){s.on("click",".room-font-item",function(e){e.preventDefault();var t=$(this).index();if(r.get()>=t&&a.get()!=c[t]){a.set(c[t]);try{ya.reportProductEvent({eid:"click/room/chatSize/"+t,eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u5f39\u5e55\u5927\u5c0f/"+c[t]})}catch(e){}}}).on("mouseenter",".room-font-item",function(){var e=$(this).index();e>r.get()&&o(f[e],$(this).position())}).on("mouseleave",".room-font-item",function(){o.clear()})}function o(e,t){var n=$('<div class="font-grade-tip common-panel-tip"><span class="tip-mark">'+e+"\u7ea7</span>\u89e3\u9501</div>");n.css({left:t.left-10,top:t.top-35}),$("#J-room-speaking-box").append(n)}function i(e){s.find(".room-font-item").removeClass("on").eq(_.indexOf(c,e)).addClass("on")}var a=e.size,r=e.grade,s=$(".room-font-list");o.clear=function(){$(".font-grade-tip").remove()},t(),n(),i(a.get()),a.change(i)}function i(){r.get(function(e){var t=new a(s(e));r.change(function(e){var n=s(e);n!==t.get()&&t.set(n)});new o({size:m,grade:t})})}var a=(e("tools"),e("DefineValue")),r=e("widget/userLevel"),c=[4,2],f=[0,20],s=function(e){var t=0;if($.isNumeric(e)){e=parseInt(e,10);for(var n=0,o=f.length;o>n&&e>=f[n];n++)t=n}return t},m=new a(c[0]);n.exports={get:m.get,change:m.change,createPalette:i}});
;dwfis.define("chat/speak",function(e){function i(e){a.isH5?a.ready(function(i){i.addTafListener("getRoomAuditConf",function(t){for(var s=t.vSpeakSwitchItem.value,n=0;n<s.length;n++)if(1003==s[n].iItemID)return e(s[n].iValue);i.removeTafListener("getRoomAuditConf")});var t=new HUYA.GetRoomAuditConfReq;t.tUserId=i.userId,t.lTid=g,t.lSid=f,t.lPid=o.lp,i.sendWup("liveui","getRoomAuditConf",t)}):(a.on("getRoomAuditConfRsp",function(i){for(var t=i.param.vSpeakSwitchItem.value,s=0;s<t.length;s++)if(1003==t[s].iItemID)return e(t[s].iValue);a.off("getRoomAuditConfRsp")}),a.ready(function(e){e.callAs("getRoomAuditConfReq")}))}function t(e){T&&a.ready(function(i){if(a.isH5){var t=new HUYA.SendMessageReq;t.tUserId=i.userId,t.lTid=g,t.lSid=f,t.lPid=o.lp,t.sContent=e,t.tBulletFormat=$.extend(t.tBulletFormat||{},h),i.sendWup("liveui","sendMessage",t)}else i.callAs("speakSendMessage",{lTid:g,lSid:f,sContent:e,tBulletFormat:h})}),v&&a.ready(function(i){if(a.isH5){var t=new HUYA.SendReplayMessageReq;t.tId=i.userId,t.sMessage=JSON.stringify({msg:e}),t.iGroupType=3,t.iGroupId=o.lp,t.sSenderNickName=a.getMyInfo().nick,i.sendWup("liveui","sendReplayMessage",t)}else i.callAs("speakSendMessage",{lTid:g,lSid:f,sContent:e,tBulletFormat:h})}),_.emit("speak",e)}function s(e,i){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=i,sel.select();else if(e.selectionStart||"0"==e.selectionStart){e.blur();var t=e.selectionStart,s=e.selectionEnd,n=e.scrollTop;e.value=e.value.substring(0,t)+i+e.value.substring(s,e.value.length),n>0&&(e.scrollTop=n),e.focus(),e.selectionStart=t+i.length,e.selectionEnd=t+i.length}else e.value+=i,e.focus()}function n(){var e=this;e.target=$("#pub_msg_input"),$("#msg_send_bt").click(function(){$(this).hasClass("enable")&&e.send()}),e.target.bind("keydown",function(i){if(13==i.keyCode){if(!i.ctrlKey)return e.send(),!1;s(e.target[0],"\r\n")}}),a.on("sendDanmuText",function(i){i&&i.param&&i.param.danmutext&&(e.target.val(i.param.danmutext),e.send())}),c.onEnter(function(i,t){3==t.iUserType&&(e.silenced=!0,e.silencedTips=t.sSendMessageTips,e.silencedTips_display=t.bSendMessagePopUp,e.silencedCD=setTimeout(function(){e.silenced=!1},1e3*t.iSendMessagePopUpAmtTime))}),c.change(function(i,t){3==t.iNewUserType?(e.silenced=!0,e.silencedTips=t.sSendMessageTips,e.silencedTips_display=t.bSendMessagePopUp,e.silencedCD=setTimeout(function(){e.silenced=!1},1e3*t.iSendMessagePopUpAmtTime)):(e.silenced=!1,e.silencedCD&&clearTimeout(e.silencedCD))}),$("#"+this.tipsId+" a").click(function(){$(this).parent().hide()})}var a=e("TTP"),o=e("TTA"),r=e("TTR"),l=e("Event"),d=e("input_ob"),c=e("auditor"),u=e("chat/barrageColor"),m=e("chat/barrageSize"),p=e("chat/barragePosition"),g=r.id,f=r.sid,T=r.isOn,v=r.isReplay,_=(r.isOff,new l),h={};return h.iFontColor=u.customColor.get(),u.customColor.change(function(){h.iFontColor=u.customColor.get()}),h.iFontSize=m.get(),m.change(function(){h.iFontSize=m.get()}),h.iTransitionType=p.get(),p.change(function(){h.iTransitionType=p.get()}),_.send=t,n.prototype={tipsId:"pubNoticMe",maxInputSize:30,msgTimer:null,disappearTimer:null,startMsg:!1,speakTime:-1,send:function(){var e=this;e.msgLimit(function(){e.sendMessage()})},msgLimit:function(e){var t=this;if(-1==t.speakTime)e&&e(),i(function(e){t.speakTime=e});else{var s=t.speakTime,n=$(".chat-room__bd3"),a=t.speakTime>=10?t.speakTime:" "+t.speakTime;if(t.startMsg){if(0==$(".room_msg_fast_tip").length){var o=$('<div class="room_msg_fast_tip">\u53d1\u8a00\u592a\u5feb\uff0c\u4e3b\u64ad\u90fd\u770b\u4e0d\u8fc7\u6765\u4e86\uff0c\u4f11\u606f <span class="msg_send_time">'+a+"</span> \u79d2\u518d\u53d1\u5427~</div>");n.append(o)}else $(".room_msg_fast_tip").show();clearTimeout(t.disappearTimer),t.disappearTimer=setTimeout(function(){$(".room_msg_fast_tip").hide(),clearTimeout(t.disappearTimer)},3e3)}else t.startMsg=!0,e&&e(),t.msgTimer||(t.msgTimer=setInterval(function(){s--;var e=s>=10?s:" "+s;$(".msg_send_time").text(e),0>=s&&(clearInterval(t.msgTimer),t.msgTimer=null,t.startMsg=!1,$(".room_msg_fast_tip").hide(),$(".msg_send_time").text(a))},1e3))}},sendMessage:function(){var e=this,i=e.target.val(),s=a_userIsLogin,n=a_userName;return""!=n||s?e.silenced&&e.silencedTips_display?void e.noticeMe(e.silencedTips):i?i.length>e.maxInputSize?void e.noticeMe("\u8f93\u5165\u5b57\u6570\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"+e.maxInputSize):(t(i),window.ya&&ya.reportProductEvent({eid:"click/zhibo/sendwords",eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u53d1\u8a00\u6309\u94ae",ayyuid:o.lp,gameId:r.gid}),e.target.val(""),void d.resetAll()):void e.noticeMe("\u8bf7\u8f93\u5165\u8981\u53d1\u8a00\u7684\u5185\u5bb9\uff01"):(NAV_UTIL.login(),!1)},noticeMe:function(e){if(e){var i=this;$("#"+i.tipsId+" p").text(e),$("#"+i.tipsId).show(),setTimeout(function(){$("#"+i.tipsId).hide()},3e3)}}},a.ready(function(){new n}),_});
;dwfis.define("chat/receive",function(e){function s(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")}function a(){$.extend(this,new l),this.on("msgFromServer",function(e){this.emit("msg",e,"server")}),this.on("msgFromSelf",function(e){this.emit("msg",e,"self")});var e=this,s=e.onSpeakMessage;o.on("displayModeChange",function(a){1==a||2==a?e.onSpeakMessage=p.throttle(s,200):(e.onSpeakMessage.cancel&&e.onSpeakMessage.cancel(),e.onSpeakMessage=s)})}function n(e){var s="";return s=e.iColor>0?'<span style="color:#'+t(e.iColor)+'">'+e.sText+"</span>":"<span>"+e.sText+"</span>"}function t(e){if(e>0){var s=e.toString(16);if(s.length<6){for(var a=6-s.length,n="",t=0;a>t;t++)n+="0";e=n+s}else e=s}else e=0;return e}var o=e("TTP"),i=e("TTR"),r=e("msgManager"),c=e("Emot"),p=e("tools"),l=e("Event"),m=e("chat/speak"),d=e("chat/speaker"),g=e("widget/fans-icon");a.prototype={showReplayMessage:function(e){var a={uid:e.uid,nick:e.nick,msg:e.msg},n=c.replace(s(e.msg)),t='<div class="msg-normal"><span class="msg-hd"><span class="name J_userMenu">'+s(e.nick)+' : </span></span><span class="text-content">'+n+"</span></div>";r.add(t,a)},showMessage:function(e){var a=e.tUserInfo,o="";try{o=s(decodeURIComponent(e.sContent))}catch(i){o=s(e.sContent)}o=o.replace(/\n/g,"<br />");var p,l,m,d=e.vDecorationPrefix.value,g="",v=0;if(d&&_.isArray(d))for(var u=0,k=d.length;k>u;u++)l=d[u].iAppId,p=d[u].iViewType,m=d[u].vData,0==p&&f[l]&&(g+=f[l](m)),1==p&&(g+=n(m)),2==p&&(g+='<img src="'+TT.trimUrl(m.sUrl).replace(".png","_3.png")+'" />'),10200==l&&(v=m.iLevel);var y=e.vDecorationSuffix.value,U="",h="",N="",M=!1;if(y&&_.isArray(y))for(var u=0,k=y.length;k>u;u++)p=y[u].iViewType,2==p&&(N=y[u].vData.sUrl,N&&(M=!0,h=N.lastIndexOf("."),U+='<img src="'+TT.trimUrl(N.slice(0,h))+"_3"+N.slice(h)+'">'));try{a.sNickName=s(decodeURIComponent(a.sNickName))}catch(i){a.sNickName=s(a.sNickName)}var S='<span class="name J_userMenu" title="\u70b9\u51fb\u67e5\u770b\u4e2a\u4eba\u4fe1\u606f">'+a.sNickName+"</span>",I={uid:a.lUid,nick:a.sNickName,msg:o},C="";C+=0==v?'<div class="msg-normal">':'<div class="noble-speak-wrap"><div class="box-noble box-noble-level-'+v+'">',C+='<span class="msg-hd">',C+='<span class="labels">'+g+"</span>",M?(C+='<span class="name-wrap">'+S+"</span>",C+='<span class="icon-labels">'+U+'<span style="color:#3c9cfe;"> : </span></span>'):C+='<span class="name-wrap">'+S+" : </span>",C+="</span>";var w=t(e.tFormat.iFontColor);C+=v>0?0!=w?'<span class="msg" style="color:#'+w+'">'+c.replace(o)+"</span></div>":'<span></i><span class="msg">'+c.replace(o)+"</span></span></div>":0!=w?'<span class="text-content" style="color:#'+w+'">'+c.replace(o)+"</span>":'<span class="text-content">'+c.replace(o)+"</span>",C+="</div>",r.add(C,I)},onSpeakMessage:function(e){var s=this,a=e.tUserInfo;if(a&&a.lUid<0){var n=t(e.tFormat.iFontColor);if(0!=n)var o='<div style="padding: 5px 9px;"><span class="msg-hd"><span class="name-wrap"><span class="name" style="cursor: default;">'+(a.sNickName?decodeURIComponent(a.sNickName)+" : </span>":"</span>")+'</span></span><span class="text-content" style="color:#'+n+'">'+decodeURIComponent(e.sContent)+"</span></div>";else var o='<div style="padding: 5px 9px;"><span class="msg-hd"><span class="name-wrap"><span class="name" style="cursor: default;">'+(a.sNickName?decodeURIComponent(a.sNickName)+" : </span>":"</span>")+'</span></span><span class="text-content">'+decodeURIComponent(e.sContent)+"</span></div>";r.add(o)}else s.showMessage(e)}};var f={10100:function(e){var s="";return 1==e.iType&&(s='<span class="admin-icon admin-icon-1"></span>'),2==e.iType&&(s='<span class="admin-icon admin-icon-0"></span>'),s},10200:function(){return""},10300:function(){var e="";return e},10400:function(e){return g.create(e.iBadgeLevel,e.sBadgeName,e.lBadgeId)}},v=new a,u=HUYA_UTIL.getCookieVal("yyuid");return i.isOn&&(o.isH5?o.ready(function(e){e.addTafListener("1400",function(e){e.tUserInfo.lUid!=u&&(v.emit("msgFromServer",e),v.onSpeakMessage(e))})}):o.on("onSpeakMessage",function(e){e.param.tUserInfo.lUid!=u&&(v.emit("msgFromServer",e),v.onSpeakMessage(e.param))})),i.isReplay&&(o.isH5?o.ready(function(e){e.addTafListener("9011",function(e){if(e.lSenderUid!=u)try{var s=$.parseJSON(e.sMessage);e.sMessage=s.msg,v.emit("msgFromServer",e),v.showReplayMessage({uid:e.lSenderUid,nick:e.sSenderNickName,msg:e.sMessage})}catch(a){}}),e.addTafListener("1400",function(e){e.tUserInfo.lUid!=u&&(v.emit("msgFromServer",e),v.showReplayMessage({uid:e.tUserInfo.lUid,nick:e.tUserInfo.sNickName,msg:e.sContent}))})}):o.on("onSpeakMessage",function(e){e.param.tUserInfo.lUid!=u&&(v.emit("msgFromServer",e),v.onSpeakMessage(e.param))})),m.on("speak",function(e){d.ready(function(){var s=d.getInfo();s.sContent=e,v.emit("msgFromSelf",s),i.isReplay&&o.isH5?v.showReplayMessage({uid:s.tUserInfo.lUid,nick:s.tUserInfo.sNickName,msg:s.sContent}):v.showMessage(s)})}),v});
;dwfis.define("chat/smog",function(e){var a=e("TTP"),n=e("TTR"),t=e("chat/receive"),s=e("msgManager"),c=e("Emot"),i=e("widget/fans-icon");n.isOn&&$.getJSON(TT.app.main+"cache1min.php",{m:"chatMessage",tid:n.id,sid:n.sid},function(e){function n(){var e=0==g?0:Math.ceil(1e3*Math.random())+500;o=setTimeout(function(){var e='<div class="msg-normal"><span class="msg-hd">';e+=i.create(l[g].badgeLevel,l[g].badgeName),e+='<span class="name">'+r(l[g].nick)+" : </span></span>",e+='<span class="text-content">'+c.replace(r(l[g].chat))+"</span>",e+="</div>",s.add(e),g++,g<l.length&&n()},e)}function r(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")}if(e&&1e3==+e.status&&e.result.chats.length>0){var l=e.result.chats,g=0;a.isFlash&&a.ready(function(){a.ready(function(e){e.callAs("cacheMessage",l)})});var o;n(),t.one("msgFromServer",function(){clearTimeout(o)})}})});
;dwfis.define("chat",function(e){var o=e("tools");e("chat/smog");var t=e("chat/barrageColor"),n=e("chat/barrageColorLevel"),a=e("chat/barrageColorFans"),r=e("chat/barrageSize"),c=e("chat/barragePosition"),i=e("chat/receive"),u=e("chat/speak"),l={};return l.barrage={color:t,size:r,position:c},l.receive=i,l.speak=u,i.on("msg",function(e){TT.emit("LIVE_ROOM_MSG_NOTICE",e)}),function(){var e=null,t=$("#J-room-chat-color"),r=$("#J-room-color-box"),c=o.once(function(){n.createPalette(),a.createPalette()}),i=function(){clearTimeout(e),c(),r.show(),t.html("")},u=function(){clearTimeout(e),e=setTimeout(function(){r.hide()},100)};t.on("mouseenter",i).on("mouseleave",u),r.on("mouseenter",i).on("mouseleave",u)}(),function(){var e=null,t=$("#J-room-speaking-box"),n=o.once(function(){r.createPalette(),c.createPalette()}),a=function(){clearTimeout(e),n(),t.show()},i=function(){clearTimeout(e),e=setTimeout(function(){t.hide()},100)};$("#J-room-chat-font").on("mouseenter",a).on("mouseleave",i),t.on("mouseenter",a).on("mouseleave",i)}(),l});
;dwfis.define("noble",function(e,n){function a(e){var n=e.param?e.param:e,a=n.tNobleInfo.iNobleLevel,i=l[parseInt(a,10)];if(a>0&&i){var t='<span class="name J_userMenu" title="\u70b9\u51fb\u67e5\u770b\u4e2a\u4eba\u4fe1\u606f">'+_.escape(n.sNickName)+"</span>",s="";s='<img class="noble-enter-pic" width="68" height="68" src="'+i+'">';var c={uid:n.lUid,nick:n.sNickName,msg:"\u8d35\u65cf\u5165\u573a\u901a\u77e5"};o.add('<div class="box-noble-enter"><div class="noble-enter-wrap box-noble-level-'+a+'"><p class="noble-enter-msg">'+t+' <span class="noble-enter-text">&nbsp;\u9a7e\u4e34\u76f4\u64ad\u95f4</span>'+s+"</p></div></div>",c)}}var i=e("TTP"),t=e("TTR"),s=e("TTA"),o=e("msgManager"),l={1:"//a.msstatic.com/huya/main/img/noble_enter/lv1_c891018.gif",2:"//a.msstatic.com/huya/main/img/noble_enter/lv2_1bce0fc.gif",3:"//a.msstatic.com/huya/main/img/noble_enter/lv3_ebbff79.gif",4:"//a.msstatic.com/huya/main/img/noble_enter/lv4_6357c6b.gif",5:"//a.msstatic.com/huya/main/img/noble_enter/lv5_edb6238.gif",6:"//a.msstatic.com/huya/main/img/noble_enter/lv6_cf93e85.gif"};i.isH5?i.ready(function(e){e.addTafListener("6110",function(e){a(e)})}):i.on("onNobleEnter",function(e){a(e)});var c=null;n.open=function(){NAV_UTIL.checkLogin(function(){e("getCreatelayer")(function(e){c?c.show():c=new e({title:"\u5f00\u901a\u8d35\u65cf",width:740,height:540,url:"//hd.huya.com/gzopen/reChargeLayer.html?anchorUid="+s.lp+"&channelId="+t.id+"&subChannelId="+t.sid+"&source=web&gameid="+t.gid,idDom:"nobleLayer",idMask:"nobleMask"})})})}});
;dwfis.define("rankTab",function(){function n(n){i!==n&&(c.removeClass("active").eq(n).addClass("active"),d.hide().eq(n).show(),t.fire(i=n))}function e(n){t.add(n)}function a(){return i}var i,t=new $.Callbacks,r=$("#J-weekRank"),c=r.find(".week-rank__btn"),d=r.find(".week-rank__unit");return n(0),c.on("click",function(e){e.preventDefault();var a=$(this).index();n(a)}),{go:n,change:e,getIndex:a}});
;dwfis.define("week_rank",function(require,exports,module){function getData(e){requested||(requested=!0,$.ajax({url:TT.app.main+"cache5min.php?m=WeekRank&do=getItemsByPid&pid="+anchor.lp,type:"GET",dataType:"json",success:function(n){var t=[];n&&0==n.error&&n.data&&n.data.vWeekRankItem&&n.data.vWeekRankItem.length&&(t=n.data.vWeekRankItem),e(t)}}))}var TTP=require("TTP"),anchor=require("TTA"),tab=require("rankTab"),ucard=require("widget/ucard"),tools=require("tools"),debounce=tools.debounce,Rank=function(data){function render(e){rankList.html(tpl({data:e}))}function bind(){var e,n,t=null,a=null;rankList.on("mouseenter",function(){lock=!0;var i=rankList.height();e=e||rankList.closest(".week-rank__unit"),n=n||e.height();var r=list.length;10>=r?i>n&&(t&&clearTimeout(t),t=setTimeout(function(){e.stop().animate({height:i})},300)):(e.height(320),a?a.reinitialise():a=e.jScrollPane({mouseWheelSpeed:20,verticalGutter:0,isOutsideNotPrevent:!1}).data("jsp"))}).on("mouseleave",function(){lock=!1,t&&clearTimeout(t),e&&e.stop().animate({height:n})}),TTP.ready(function(){var e;rankList.on("mouseenter",".J_name",e=debounce(function(n){var t=null,a=null,i=$(window).scrollLeft()+Math.min(n.clientX+15,$(window).width()-260),r=$(window).scrollTop()+Math.min(n.clientY+10,$(window).height()-340),l=$(this).closest("li"),o=list[l.index()];o&&ucard({uid:o.lUid,muteText:"\u5468\u8d21\u699c",init:function(n){a=n,n.view.css({left:i,top:r,zIndex:10,position:"absolute"}),n.view.find(".ucard-x").hide(),n.view.on("mouseenter",function(){clearTimeout(t),e.cancel()}).on("mouseleave",function(){n.destroy()}),n.view.appendTo("body");try{ya.reportProductEvent({eid:"click/zhibo/kp/zgb",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u7528\u6237\u5361\u7247/\u5468\u8d21\u699c"})}catch(l){}}}),$(this).on("mouseleave",function(){t=setTimeout(function(){a&&a.destroy()},200)})},800)).on("mouseleave",function(){e&&e.cancel()})})}function update(e){lock||(list=e,render(e),changeCallbacks.fire(e))}var list=data&&data.length?data:[],changeCallbacks=$.Callbacks(),tpl=function(obj){function formatNumber(e,n){for(var t=e?e.toString().split("."):["0"],a=n?n.split("."):[""],i="",r=t[0],l=a[0],o=r.length-1,s=!1,u=l.length-1;u>=0;u--)switch(l.substr(u,1)){case"#":o>=0&&(i=r.substr(o--,1)+i);break;case"0":i=o>=0?r.substr(o--,1)+i:"0"+i;break;case",":s=!0,i=","+i}if(o>=0)if(s)for(var c=r.length;o>=0;o--)i=r.substr(o,1)+i,o>0&&(c-o)%3==0&&(i=","+i);else i=r.substr(0,o+1)+i;i+=".",r=t.length>1?t[1]:"",l=a.length>1?a[1]:"",o=0;for(var u=0;u<l.length;u++)switch(l.substr(u,1)){case"#":o<r.length&&(i+=r.substr(o++,1));break;case"0":i+=o<r.length?r.substr(o++,1):"0"}return i.replace(/^,+/,"").replace(/\.$/,"")}{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",data&&data.length){for(var len=data.length,i=0;len>i;i++){var tip="";0==i?tip="num-one":1==i?tip="num-two":2==i&&(tip="num-three");var item=data[i],iNobleLevel=item.iNobleLevel,sNickName=_.escape(item.sNickName),iLevel=item.iUserLevel,beanNum=formatNumber(item.iScore,"#,###");__p+='\r\n        <li><span class="item-num '+(null==(__t=tip)?"":__t)+'">'+(null==(__t=i+1)?"":__t)+"</span>\r\n\r\n            ",iNobleLevel>0&&(__p+='\r\n                <span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>\r\n            '),__p+='\r\n\r\n            <span class="week-rank-name J_name">'+(null==(__t=sNickName)?"":__t)+'</span>\r\n\r\n           \r\n            <span class="level-icon level-icon'+(null==(__t=iLevel)?"":__t)+'"></span>\r\n            \r\n\r\n            <span class="gold-num">'+(null==(__t=beanNum)?"":__t)+"<i></i></span>\r\n\r\n        </li>\r\n"}__p+="\r\n\r\n    ",data.length>3&&(__p+='\r\n        <li class="showMore">\u6309\u6700\u8fd17\u5929\u89c2\u4f17\u9001\u793c\u6392\u884c</li>\r\n    '),__p+="\r\n"}else __p+='\r\n    <div class="no-rank-tip">\u9001\u4e3b\u64ad\u793c\u7269\uff0c\u4e0a\u8d21\u732e\u699c</div>\r\n';__p+="\r\n\r\n"}return __p},rankList=$("#week-rank-list"),lock=!1;return render(list),bind(),{update:update,getData:function(){return list},change:function(e){changeCallbacks.add(e)}}},visible=0===tab.getIndex();tab.change(function(e){visible=0===e});var rank=null,update=function(){function e(e){rank?rank.update(e):rank=new Rank(e)}var n=null;return tab.change(function(){visible&&n&&(e(n),n=null)}),function(t){visible?e(t):n=t}}();TTP.isH5?TTP.ready(function(e){e.addTafListener("6220",function(e){update(e.vWeekRankItem.value)})}):TTP.on("weekRankListRefresh",function(e){e.param.data.lPid&&e.param.data.lPid!=anchor.lp||update(e.param.data.vWeekRankItem)}),visible?getData(update):(tab.change(function(){visible&&!rank&&getData(update)}),$(window).on("load",function(){!rank&&getData(update)}),setTimeout(function(){!rank&&getData(update)},1e4));var requested=!1});
;dwfis.define("fans_rank",function(require,exports,module){var TTP=require("TTP"),TTA=require("TTA"),tab=require("rankTab"),ucard=require("widget/ucard"),tools=require("tools"),fansIcon=require("widget/fans-icon"),Rank=function(data){function render(e){rankList.html(tpl(e))}function bind(){var e,n,t=null,i=null;rankList.on("mouseenter",function(){lock=!0;var a=rankList.height();e=e||rankList.closest(".week-rank__unit"),n=n||e.height();var r=list.length;10>=r?a>n&&(t&&clearTimeout(t),t=setTimeout(function(){e.stop().animate({height:a})},300)):(e.height(320),i?i.reinitialise():i=e.jScrollPane({mouseWheelSpeed:20,verticalGutter:0,isOutsideNotPrevent:!1}).data("jsp"))}).on("mouseleave",function(){lock=!1,t&&clearTimeout(t),e&&e.stop().animate({height:n})}),TTP.ready(function(){var e;rankList.on("mouseenter",".J_name",e=tools.debounce(function(n){var t=null,i=null,a=$(window).scrollLeft()+Math.min(n.clientX+15,$(window).width()-260),r=$(window).scrollTop()+Math.min(n.clientY+10,$(window).height()-340),o=$(this).closest("li"),l=list[o.index()];l&&ucard({uid:l.lUid,muteText:"\u7c89\u4e1d\u699c",init:function(n){i=n,n.view.css({left:a,top:r,zIndex:10,position:"absolute"}),n.view.find(".ucard-x").hide(),n.view.on("mouseenter",function(){clearTimeout(t),e.cancel()}).on("mouseleave",function(){n.destroy()}),n.view.appendTo("body");try{ya.reportProductEvent({eid:"click/zhibo/kp/fst",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u7528\u6237\u5361\u7247/\u7c89\u4e1d\u699c"})}catch(o){}}}),$(this).on("mouseleave",function(){t=setTimeout(function(){i&&i.destroy()},200)})},800)).on("mouseleave",function(){e&&e.cancel()})})}function update(e){lock||(data=e,render(data))}var list=data.vItem||[],tpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",vItem&&vItem.length){for(var len=vItem.length,i=0;len>i;i++){var tip="";0==i?tip="num-one":1==i?tip="num-two":2==i&&(tip="num-three");var item=vItem[i],iNobleLevel=item.iNobleLevel,sNickName=_.escape(item.sNickName),iLevel=item.iUserLevel,iBadgeLevel=item.iBadgeLevel,iScore=item.iScore;__p+='\r\n        <li>\r\n        \r\n            <span class="item-num '+(null==(__t=tip)?"":__t)+'">'+(null==(__t=i+1)?"":__t)+"</span>\r\n\r\n            ",iNobleLevel>0&&(__p+='\r\n                <span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>\r\n            '),__p+='\r\n            <span class="week-rank-name J_name">'+(null==(__t=sNickName)?"":__t)+'</span>\r\n            <span class="level-icon level-icon'+(null==(__t=iLevel)?"":__t)+'"></span>\r\n            <span class="fansScore">'+(null==(__t=tools.format(iScore))?"":__t)+"</span>\r\n            ",""!=sBadgeName&&(__p+="\r\n                "+(null==(__t=fansIcon.create(iBadgeLevel,sBadgeName))?"":__t)+"\r\n            "),__p+="\r\n        </li>\r\n"}__p+="\r\n\r\n    ",vItem.length>3&&(__p+='\r\n        <li class="showMore">\u6309\u6700\u8fd17\u5929\u7c89\u4e1d\u4eb2\u5bc6\u5ea6\u4e0a\u5347\u6392\u884c</li>\r\n   '),__p+="\r\n"}else __p+='\r\n    <div class="no-rank-tip">'+(null==(__t=sBadgeName?"\u4e00\u6b21\u6027\u9001\u51fa10\u4e2a\u5c0f\u793c\u7269\u4e0a\u699c":"\u4e3b\u64ad\u6682\u672a\u5f00\u901a\u7c89\u4e1d\u5fbd\u7ae0")?"":__t)+"</div>\r\n";__p+="\r\n\r\n"}return __p},rankList=$("#fans-list"),lock=!1;return render(data),bind(),{update:update}},getData=function(e){$.ajax({url:TT.app.main+"cache.php?m=Fans&do=getFansScoreUpList&profileUid="+TTA.lp,dataType:"json",success:function(n){n&&200==n.status&&n.data&&e(n.data)}})},createRank=function(){var e=null,n=function(n){e?e.update(n):e=new Rank(n)},t=0;return function(){0===t&&(getData(n),t=1,setTimeout(function(){t=0},6e4))}}();1===tab.getIndex()&&createRank(),tab.change(function(e){1===e&&createRank()})});
;dwfis.define("chatTab",function(e,n,t){function r(e){if(!(!$.isNumeric(e)||0>e||e>=l||o===e)){var n=h.eq(e).attr("tab_index");$.isNumeric(n)&&(o=e,s=parseInt(n,10),h.removeClass("current").eq(o).addClass("current"),f.hide().eq(o).show(),u.fire(o,s))}}function a(e){u.add(e)}function i(){return o}function c(){return s}var o,s,d=e("TTR"),u=new $.Callbacks,h=$(".chat-room__tab"),f=$(".chat-room__bd"),l=Math.min(h.length,f.length);h.on("click",function(e){e.preventDefault();var n=$(this).index();r(n)});var g={go:r,change:a,size:l,getId:c,getIndex:i};g.go(d.isOn?0:$(".chat-room__bd2").length?1:0),t.exports=g});
;dwfis.define("vipList",function(require,exports,module){function getData(e){requested||(requested=!0,$.ajax({url:TT.app.main+"cache1min.php",type:"GET",dataType:"json",data:{m:"VipBarList",tid:TTR.id,sid:TTR.sid},dataType:"json",success:function(a){var t=null;a&&1e3==a.status&&a.result&&a.result.items&&a.result.items.length&&(t={list:a.result.items,total:a.result.total,sBadgeName:a.result.sBadgeName,sVLogo:a.result.sVLogo}),e(t)}}))}var TTR=require("TTR"),TTP=require("TTP"),anchor=require("TTA"),tab=require("chatTab"),ucard=require("widget/ucard"),tools=require("tools"),fansIcon=require("widget/fans-icon"),debounce=tools.debounce,Rank=function(data){function render(e){rankList.html(tpl({data:e.list,sBadgeName:e.sBadgeName,sVLogo:e.sVLogo})),e.total>100?tips.text("\u4f59\u4e0b "+(e.total-100)+" \u4f4d\u8d35\u5bbe\u672a\u88ab\u5c55\u793a\uff0c\u5347\u7ea7\u8d35\u65cf\u6216\u5b88\u62a4\u53ef\u63d0\u5347\u6392\u540d").show():tips.hide(),scrollbar?scrollbar.reinitialise():(scrollbar=scroll.jScrollPane({scrollbarWidth:8,mouseWheelSpeed:20,isOutsideNotPrevent:!1}).data("jsp"),scrollbar.getIsScrollableV()||setTimeout(function(){scrollbar.reinitialise({isOutsideNotPrevent:!0})},200))}function bind(){$(window).resize(debounce(function(){scrollbar.reinitialise()},60)),TTP.ready(function(){var e;rankList.on("mouseenter","li",e=debounce(function(a){var t=null,n=null,i=$(window).scrollLeft()+Math.min(a.clientX+15,$(window).width()-260),r=$(window).scrollTop()+Math.min(a.clientY+10,$(window).height()-340),o=$(this),l=viper.list[o.index()];l&&ucard({uid:l.lUid,muteText:"\u8d35\u5bbe\u5e2d",init:function(a){n=a,a.view.css({left:i,top:r,zIndex:10,position:"absolute"}),a.view.find(".ucard-x").hide(),a.view.on("mouseenter",function(){clearTimeout(t),e.cancel()}).on("mouseleave",function(){a.destroy()}),a.view.appendTo("body");try{ya.reportProductEvent({eid:"click/zhibo/kp/xcgb",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u7528\u6237\u5361\u7247/\u73b0\u573a\u8d35\u5bbe"})}catch(o){}}}),o.on("mouseleave",function(){t=setTimeout(function(){n&&n.destroy()},200)})},800)).on("mouseleave",function(){e&&e.cancel()})})}function update(e){viper=e,render(e),changeCallbacks.fire(e)}var viper=data,changeCallbacks=$.Callbacks(),tpl=function(obj){function creatGuardIcon(e){if(!$.isNumeric(e))return"";e=parseInt(e,10);for(var a=[1,12,520,1314],t=-1,n=0,i=a.length;i>n&&e>=a[n];n++)t++;return t>-1?'<span class="sh-icon sh-icon'+(t+1)+'"></span>':""}{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",data&&data.length){for(var user=null,i=0,l=data.length;l>i;i++){user=data[i];var iNobleLevel=user.tNobleInfo.iNobleLevel,iGuardLevel=user.tGuardInfo.iGuardLevel,iBadgeLevel=user.tFansInfo.iBadgeLevel,iVFlag=user.tFansInfo.iVFlag,sNickName=user.sNickName,iUserLevel=user.iUserLevel;try{sNickName=decodeURIComponent(_.escape(sNickName))}catch(e){sNickName=_.escape(sNickName)}__p+='\r\n        <li class="current-peo-item">\r\n            ',iNobleLevel>0&&(__p+='<span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>'),__p+="\r\n            "+(null==(__t=creatGuardIcon(iGuardLevel))?"":__t)+"\r\n            "+(null==(__t=fansIcon.create(iBadgeLevel,sBadgeName))?"":__t)+'\r\n            <span class="peo-name J_name">'+(null==(__t=sNickName)?"":__t)+"</span>\r\n            ",iVFlag&&(__p+=" "+(null==(__t=sVLogo?'<img class="vfans-icon-custom" src="'+TT.trimUrl(sVLogo).replace(".png","_3.png")+'" />':'<span class="vfans-icon"></span>')?"":__t)+" "),__p+="\r\n            ",iUserLevel&&(__p+='<span class="level-icon level-icon'+(null==(__t=iUserLevel)?"":__t)+'"></span>'),__p+="\r\n        </li>\r\n"}__p+="\r\n\r\n"}__p+="\r\n"}return __p},rankList=$("#chat-current-peo"),tips=$(".current-peo-foot"),scroll=$(".chat-room__bd4").find(".chat-roomOther__scroll"),scrollbar=null;return render(viper),bind(),{update:update,getData:function(){return viper},change:function(e){changeCallbacks.add(e)}}},visible=4===tab.getId();tab.change(function(e,a){visible=4===a});var rank=null,update=function(){function e(e){rank?rank.update(e):rank=new Rank(e)}var a=null;return tab.change(function(){visible&&a&&(e(a),a=null)}),function(t){t&&t.list&&"number"==typeof t.total&&($("[tab_index=4]").text("\u73b0\u573a\u8d35\u5bbe("+t.total+")"),visible?e(t):a=t)}}();TTP.isH5?TTP.ready(function(e){e.addTafListener("6210",function(e){update({list:e.vVipBarItem.value,total:e.iTotal,sBadgeName:e.sBadgeName,sVLogo:e.sVLogo})})}):TTP.on("vipBarListReflesh",function(e){if(e.param.data.lPid&&e.param.data.lPid!=anchor.lp)return!1;var a=e.param.data;update({list:a.vVipBarItem,total:a.iTotal,sBadgeName:a.sBadgeName,sVLogo:a.sVLogo})}),visible?getData(update):(tab.change(function(){visible&&!rank&&getData(update)}),$(window).on("load",function(){!rank&&getData(update)}),setTimeout(function(){!rank&&getData(update)},1e4));var requested=!1});
;dwfis.define("anchorStore",function(t){function e(){if(a&&!o){o=!0;var t=$(".chat-room__bd2").find(".chat-roomOther__scroll"),e=null,i=n.debounce(function(i){e?e.reinitialise():e=t.jScrollPane({scrollbarWidth:8,mouseWheelSpeed:20,isOutsideNotPrevent:!1}).data("jsp"),"function"==typeof i&&setTimeout(i,0)},200),c=t.find("img[data-src]"),s=0;c.each(function(){var t=this,a=t.getAttribute("data-src");n.loadImg(a,function(){s+=1,i(function(){s>=c.length&&!e.getIsScrollableV()&&e.reinitialise({isOutsideNotPrevent:!0})})},function(){t.src="//a.msstatic.com/huya/main/assets/img/default_live.jpg"},t)}),$(window).resize(i)}}var i=t("chatTab"),n=t("tools"),a=2==i.getId();i.change(function(t,e){a=2==e});var o=!1;e(),i.change(e)});
;dwfis.define("input_ob",function(){var t=30,n=function(){this.target=$(".chat-room__ft"),this.$pubMsgInput=this.target.find("#pub_msg_input"),this.$btnSendMsg=this.target.find(".btn-sendMsg"),this.$msgInputNum=this.target.find(".msg-input-num"),this.eventInit()};n.prototype.checkWordsLeft=function(){var n=this,e=n.$pubMsgInput.val(),s=e.length;s>t&&(n.$pubMsgInput.val(e.substring(0,t)),s=t),s>t?(n.$btnSendMsg.removeClass("enable"),n.$msgInputNum.addClass("input-overflow")):0==s?(n.$btnSendMsg.removeClass("enable"),n.$msgInputNum.removeClass("input-overflow")):(n.$btnSendMsg.addClass("enable"),n.$msgInputNum.removeClass("input-overflow")),n.$msgInputNum.text(s+"/"+t)},n.prototype.resetAll=function(){var n=this;n.$btnSendMsg.removeClass("enable"),n.$msgInputNum.text("0/"+t)},n.prototype.eventInit=function(){var t=this;t.resetAll(),setTimeout(function(){NAV_UTIL.getStatus(function(){a_userIsLogin?(t.$pubMsgInput.val(""),$(".no-login-tip").hide()):$(".no-login-tip").on("click",function(){NAV_UTIL.checkLogin(function(){$(".no-login-tip").off("click")})})})},1500),this.$pubMsgInput.on("focus",function(){NAV_UTIL.checkLogin(function(){})}).on("keyup",function(){t.checkWordsLeft()})};var e=new n;return NAV_UTIL.isLogin()||$(".no-login-tip").show(),e});
;dwfis.define("hideshare",function(o){var d,e,r,i,h,s,t,a,m,n=o("tools"),w=function(){d=d||$("#J_roomHeader"),e=e||$(".J_roomHdDetail"),r=r||$(".J_roomHdCtrlOther"),i=i||$(".room-hd-aside"),s=s||e.width(),t=t||r.width(),a=a||i.width(),m=m||100+s+t+15+a,h=d.width(),m>=h?d.addClass("room-hd-crowd"):d.removeClass("room-hd-crowd")},c=n.debounce(w,60);c(),TT.on("resizeWide",c),TT.on("ROOM_HEADER_CTRL_RESIZE",function(){t=0,m=0,$("#J_roomHeader").removeClass("room-hd-crowd"),c()})});
;dwfis.define("share",function(require,exports,module){function getQRCode(e){"function"!=typeof e&&(e=function(){}),require.async("qrcode",e)}function Share(){this.initialize.apply(this,arguments)}var TTR=require("TTR"),anchor=require("TTA");$(window).on("load",getQRCode),setTimeout(getQRCode,1e4),Share.prototype={initialize:function(e){this.$domId=$(e.domId),this.url=TT.app.main+"member/index.php?m=Share&do=getLiveShareInfo",this.paramObJ=e,this.bindEvent()},getLiveShareInfo:function(e,n){$.ajax({url:this.url,type:"GET",dataType:"json",async:!1,data:{uid:this.paramObJ.roomPid,action:location.href,platform:e}}).done(function(e){200==e.status&&n&&n(e.data)})},qrcode:function(){var e=this;getQRCode(function(){$("#scan-region-qrcode").qrcode({render:"Microsoft Internet Explorer"==navigator.appName?"table":"canvas",text:"http://rel.huya.com/room?sid="+e.paramObJ.chTopId+"&subsid="+e.paramObJ.subChId+"&presenteruid="+e.paramObJ.roomPid+"&utm=w&sourceType="+e.paramObJ.iSourceType+"&screenType="+e.paramObJ.screenType,width:138,height:138})})},copyFn:function(){function e(){function e(){var e=$(".copy-sucess");0==e.length?$("body").append('<div class="copy-sucess">\u5df2\u6210\u529f\u590d\u5236\u5230\u60a8\u7684\u526a\u5207\u9762\u677f</div>'):e.show(200),a&&clearTimeout(a),a=setTimeout(function(){$(".copy-sucess").hide(200)},2e3)}var n=this.$domId.find(".entrance-expand"),t=this.$domId.find(".share-copy-btn"),a=null;if($("body").on("mouseenter.zeroclipboard",".global-zeroclipboard-container",function(){n.show()}),this.$domId.on("mouseenter",function(){n.show()}).on("mouseleave",function(){n.hide()}),window.clipboardData)t.on("click",function(){var n=$(this).attr("data-clipboard-target");e(),window.clipboardData.setData("Text",$("#"+n).val())});else{var i="//a.msstatic.com/huya/main/lib/ZeroClipboard_67fa114.swf";setTimeout(function(){var n=new ZeroClipboard(t,{moviePath:i,hoverClass:"share-copy-btn-hover",trustedDomains:[window.location.host]});n.on("complete",function(){e();try{ya.reportProductEvent({eid:$(this).attr("eid"),eid_desc:$(this).attr("eid_desc")})}catch(n){}})},100)}}var n="//a.msstatic.com/huya/main/lib/ZeroClipboard_eb164bc.js",t=this;$.ajax(n,{dataType:"script",cache:!0,success:function(){e.call(t)}})},render:function(){var tmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var roomPath=obj.privateHost||obj.yyid||obj.chTopId+"/"+obj.subChId;__p+='\r\n<em class="arrow"></em>\r\n<div class="entrance-expand-bor"></div>\r\n<div class="share-box">\r\n    <div class="share-bd clearfix">\r\n        <div class="share-wx">\r\n            <span class="wx-face"></span>\r\n            <div class="qr-code-wrap">\r\n                <span class="wx-icon"></span>\r\n                <div id="scan-region-qrcode"></div>\r\n            </div>\r\n        </div>\r\n        <div class="share-cnt">\r\n            <div class="share-list clearfix">\r\n                <span title="\u5206\u4eab\u5230\u65b0\u6d6a\u5fae\u535a" data-platform="3" class="wb-icon clickstat" eid="click/share/3/'+(null==(__t=obj.roomPid)?"":__t)+'" eid_desc="\u70b9\u51fb/\u5206\u4eab/\u5fae\u535a/\u4e3b\u64aduid"></span>\r\n                <span title="\u5206\u4eab\u5230QQ" data-platform="4" class="qq-icon clickstat" eid="click/share/4/'+(null==(__t=obj.roomPid)?"":__t)+'" eid_desc="\u70b9\u51fb/\u5206\u4eab/QQ/\u4e3b\u64aduid"></span>\r\n                <span title="\u5206\u4eab\u5230QQ\u7a7a\u95f4" data-platform="5" class="qzone-icon clickstat" eid="click/share/5/'+(null==(__t=obj.roomPid)?"":__t)+'" eid_desc="\u70b9\u51fb/\u5206\u4eab/QQ\u7a7a\u95f4/\u4e3b\u64aduid"></span>\r\n                <span title="\u5206\u4eab\u5230\u8d34\u5427" data-platform="6" class="tb-icon clickstat" eid="click/share/6/'+(null==(__t=obj.roomPid)?"":__t)+'" eid_desc="\u70b9\u51fb/\u5206\u4eab/\u8d34\u5427/\u4e3b\u64aduid"></span>\r\n            </div>\r\n            <ul class="share-link">\r\n                <li class="share-link-item">\r\n                    <input type="text" readonly="readonly" value="'+(null==(__t=location.protocol+"//"+location.hostname+location.pathname)?"":__t)+'" id="room-link" class="share-link-input">\r\n                    <span class="share-copy-btn" data-clipboard-target="room-link" eid="click/Live/liveURL" eid_desc="\u70b9\u51fb/\u76f4\u64ad\u95f4/\u590d\u5236\u76f4\u64ad\u95f4\u5730\u5740">\u590d\u5236\u76f4\u64ad\u95f4\u5730\u5740</span>\r\n                </li>\r\n                ',1!=obj.isLive&&(__p+='\r\n                    <li class="share-link-item">\r\n                        <input type="text" readonly="readonly" value="http://liveshare.huya.com/'+(null==(__t=roomPath)?"":__t)+'/huyacoop.swf" id="flash-link" class="share-link-input">\r\n                        <span class="share-copy-btn" data-clipboard-target="flash-link" eid="click/Live/vURL" eid_desc="\u70b9\u51fb/\u76f4\u64ad\u95f4/\u590d\u5236\u64ad\u653e\u5668\u5730\u5740">\u590d\u5236\u64ad\u653e\u5668\u5730\u5740</span>\r\n                    </li>\r\n                    <li class="share-link-item">\r\n                        <input type="text" readonly="readonly" value=\'<embed width="800" height="500" allownetworking="all" allowscriptaccess="always" src="http://liveshare.huya.com/'+(null==(__t=roomPath)?"":__t)+'/huyacoop.swf" quality="high" bgcolor="#000" wmode="window" allowfullscreen="true" allowFullScreenInteractive="true" type="application/x-shockwave-flash">\' id="flash-code" class="share-link-input">\r\n                        <span class="share-copy-btn" data-clipboard-target="flash-code" eid="click/Live/vCode" eid_desc="\u70b9\u51fb/\u76f4\u64ad\u95f4/\u590d\u5236\u64ad\u653e\u5668\u4ee3\u7801">\u590d\u5236\u64ad\u653e\u5668\u4ee3\u7801</span>\r\n                    </li>    \r\n               '),__p+="\r\n            </ul>  \r\n        </div>\r\n    </div>\r\n</div>"}return __p};this.$domId.find(".entrance-expand").html(tmpl(this.paramObJ))},bindEvent:function(){var e=this;this.$domId.one("mouseover",function(){e.render(),e.qrcode(),e.copyFn(),e.shareEvent()})},shareEvent:function(){function e(e,n){var a=encodeURIComponent(n.sAction),i=encodeURIComponent(n.sTitle),o=encodeURIComponent(n.sContent),r=encodeURIComponent(n.sImageUrl);return t[e](a,i,o,r)}var n=this,t={3:function(e,n,t,a){return"http://service.weibo.com/share/share.php?url="+e+"&title="+n+"&pic="+a+"&language=zh_cn"},4:function(e,n,t,a){return"http://connect.qq.com/widget/shareqq/index.html?url="+e+"&desc="+t+"&title="+n+"&pics="+a+"&summary="+t},5:function(e,n,t,a){return"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+e+"&title="+n+"&pics="+a+"&summary="+t},6:function(e,n,t,a){return"http://tieba.baidu.com/f/commit/share/openShareApi?title="+n+"&url="+e+"&to=tieba&type=text&relateUid=&pics="+a+"&key=&sign=on&desc=&comment="+t}};$(".share-list").on("click","span",function(){var t=$(this),a=t.data("platform");n.getLiveShareInfo(a,function(n){var t=e(a,n);window.open(t,"_blank")})})},destroy:function(){}},new Share({domId:"#share-entrance",chTopId:TTR.id,subChId:TTR.sid,screenType:TTR.screenType,iSourceType:TTR.liveSourceType,privateHost:TTR.privateHost,yyid:anchor.yyid,isLive:TTR.isOff,roomPid:anchor.lp})});
;dwfis.define("treasureChest",function(e){var t=e("TTP"),a=e("TTR"),s=e("dialog"),i=e("msgManager");!function(){function e(e){this.state="READY",this.data=$.extend({},e),this.delay=this.data.delay,this.statechangeCallbacks=$.Callbacks(),this.statechange=function(e){this.statechangeCallbacks.add(e)},this.onCdCallbacks=$.Callbacks(),this.onCd=function(e){this.onCdCallbacks.add(e)}}function n(){f.find("img").attr("src","images/box_9de85e8.png"),f.find(".btn").removeClass("usable disable").text("loading"),f.show()}function r(t){var a=new e(t);return a.statechange(function(e){var t=f.find(".btn"),s=f.find("img"),i=f.find(".nick");"START"===e&&(i.text(d(a.data.senderNick)),n()),"CD"===e&&a.onCd(function(e){var a=Math.floor(e/60),s=e%60;t.text((10>a?"0":"")+a+":"+(10>s?"0":"")+s)}),"ING"===e&&(s.attr("src","//a.msstatic.com/huya/main/img/room/treasure-chest/box_3951e08.gif?"+(new Date).getTime()),t.addClass("usable").text("\u9886\u53d6"),t.on("click",function(e){e.preventDefault(),a.draw()})),"ED"===e&&t.removeClass("usable").addClass("disable").text("\u5df2\u9886\u53d6"),"END"==e&&v().dequeue()}),v().list[0]=a,a.start(),a}function c(e){var t=null;try{console.log("\u524d\u7aef: treasureUpdateNotice.iState:"+e.iState)}catch(a){}switch(e.iState){case 1:r({senderNick:e.sSendNick,delay:e.iCountDown});break;case 2:(t=v().list[0])&&t.end();break;case 3:v().enqueue(null)}}function o(e){try{console.log("\u524d\u7aef: queryTreasureInfoRsp.iQueneSize:"+e.iQueneSize)}catch(t){}if(p&&v().clear(),!(e.iQueneSize<=0)){for(;e.iQueneSize--;)v().enqueue(null);r({state:["","CD","ING","ED"][e.iStatus],delay:e.iCountDown,senderNick:e.sNickName})}}function l(e){if(e.iPrizeType<=0){var t=s.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<p class="tct-cont">\u624b\u6c14\u4e0d\u4f73\uff0c\u4f60\u6ca1\u6709\u9886\u53d6\u5230\u5956\u52b1~</p>',"</div>",0/0].join(""),lock:!1});return void setTimeout(function(){t.close()},3e3)}if(6==e.iPrizeType||9==e.iPrizeType||14==e.iPrizeType){var t=s.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<div class="tct-cont">','<p>\u606d\u559c\u4f60\u83b7\u5f97<em class="tct-prize">'+e.sPrizeName+"</em>\uff01</p>",'<p class="tct-ps">\u5956\u52b1\u5df2\u5b58\u5165'+(14==e.iPrizeType?'<a target="_blank" href="'+TT.app.i+'index.php?m=MyGift&do=listMyGift">\u6211\u7684\u798f\u5229</a>':"\u5305\u88f9")+"\u4e2d\uff0c\u5feb\u53bb\u67e5\u770b\u5427~</p>","</div>","</div>",'<a class="tct-x" href="#"></a>',0/0].join(""),lock:!1});t.view.find(".tct-x").on("click",function(e){e.preventDefault(),t.close()})}else{var t=s.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<p class="tct-cont">\u606d\u559c\u4f60\u83b7\u5f97<em class="tct-prize">'+e.sPrizeName+"</em>\uff01</p>","</div>",0/0].join(""),lock:!1});setTimeout(function(){t.close()},3e3)}}function u(e){var t=['<div class="treasureChest-winningRecord">','<span class="treasureChest-winningRecord-user">'+d(e.sUserNick)+"</span>"," \u83b7\u5f97 ",'<span class="treasureChest-winningRecord-sender">'+d(e.sStarterNick)+"</span>"," \u6d3e\u9001\u7684 ",'<span class="treasureChest-winningRecord-prize">'+e.sPrizeName+"</span>","</div>"].join("");i.add(t)}function d(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")}TT.isProd;e.prototype={delay:180,duration:15,start:function(){var e=this;if("READY"===e.state)switch(e.state="START",e.statechangeCallbacks.fireWith(e,[e.state]),e.data.state){case"CD":e.countdown(e.delay);break;case"ING":e.open(e.duration);break;case"ED":e.ed();break;default:e.countdown(e.delay)}},countdown:function(e){var t=this;t.state="CD",t.statechangeCallbacks.fireWith(t,[t.state]);var a=e,s=e;t.onCdCallbacks.fireWith(t,[a,s]),t.cdInterval=setInterval(function(){a--,t.onCdCallbacks.fireWith(t,[a,s]),0>=a&&(clearInterval(t.cdInterval),t.open(t.duration))},1e3)},open:function(){var e=this;e.state="ING",e.statechangeCallbacks.fireWith(e,[e.state])},end:function(){var e=this;clearInterval(e.cdInterval),e.state="END",e.statechangeCallbacks.fireWith(e,[e.state])},ed:function(){var e=this;e.state="ED",e.statechangeCallbacks.fireWith(e,[e.state])},draw:function(){if(!NAV_UTIL.isLogin())return void NAV_UTIL.login();if("ING"===this.state){var e=this;t.ready(function(e){if(t.isH5){e.addTafListener("sendTreasureLotteryDraw",function(t){l(t),e.removeTafListener("sendTreasureLotteryDraw")});var s=new HUYA.TreasureLotteryDrawReq;$.extend(s,{tId:e.userId,sStarterNick:DUYA_INS.userNick,lSid:a.id,lSubSid:a.sid}),e.sendWup("liveui","sendTreasureLotteryDraw",s)}else t.on("treasureLotteryDrawRsp",function(e){l(e.param),t.off("treasureLotteryDrawRsp")}),e.callAs("treasureLotteryDrawReq")}),e.ed()}}};var h=function(){this.list=[],this.size=0,this.changeCallbacks=$.Callbacks(),this.change=function(e){this.changeCallbacks.add(e)}};h.prototype.enqueue=function(e){this.list.push(e),this.size+=1,this.changeCallbacks.fireWith(this,[1,e])},h.prototype.dequeue=function(){if(!(this.size<=0)){var e=this.list.shift();this.size-=1,this.changeCallbacks.fireWith(this,[0,e])}},h.prototype.clear=function(){var e=this.list;this.list=[],this.size=0,this.changeCallbacks.fireWith(this,[-1,e])};var f=null,p=!1,v=function(){var e=null;return function(){return e||(p=!0,e=new h,f=$('<div class="liveRoom_treasureChest"><span class="box"><img src="images/box_9de85e8.png" alt="\u5b9d\u7bb1" /></span><i class="num"></i><p class="btn-wrap"><span class="btn">loading</span></p><div class="waitTips"><p class="tit"><span class="nick">\u571f\u8c6a</span>\u7684\u85cf\u5b9d\u56fe</p><div class="cont"><p>\u9886\u53d6\u8fd8\u672a\u5f00\u59cb\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85~</p><p>\u591a\u53d1\u5f39\u5e55\u53ef\u63d0\u9ad8\u4e2d\u5956\u6982\u7387\u54e6\uff01</p></div><i class="arrow"></i></div></div>'),f.on("mouseenter",function(){var e=v().list[0];e&&"CD"===e.state&&f.find(".waitTips").show()}).on("mouseleave",function(){f.find(".waitTips").hide()}),$("#watchChat_pub").append(f),e.change(function(t,a){var s=f.find(".num");s.text(this.size)[this.size>1?"show":"hide"](),1===t&&1===this.size&&n(),0===t&&(this.size>0?n():f.hide(500)),-1===t&&(a[0]&&a[0].end(),f.remove(),e=null,p=!1)})),e}}();t.isH5?t.ready(function(e){e.addTafListener("queryTreasure",o);var t=new HUYA.QueryTreasureInfoReq;$.extend(t,{tId:e.userId,lSid:a.id,lSubSid:a.sid}),e.sendWup("liveui","queryTreasure",t)}):t.on("queryTreasureInfoRsp",function(e){o(e.param)},!0),t.isH5?t.ready(function(e){e.addTafListener("6604",c)}):t.on("treasureUpdateNotice",function(e){c(e.param)}),t.isH5?t.ready(function(e){e.addTafListener("6605",u)}):t.on("treasureLotteryResultNotice",function(e){u(e.param)})}()});
;dwfis.define("videoScale",function(e){var n=e("TTP"),o=e("TTR");$(function(){var e=o.liveCompatibleFlag;1===(1&e)&&$("#liveRoomObj").on("mousewheel",function(e,o){return 1==o?n.ready(function(){n.call("onMouseWheel360",-1)}):-1==o&&n.ready(function(){n.call("onMouseWheel360",1)}),!1})})});
;dwfis.define("room_core",function(e){function n(e){var n="",t={showSafetyVerifyPopupBox:"showPopupBox",closeSafetyVerifyPopupBox:"closePopupBox",setUsedClientCAMark:"safetyVerifyFlashCallSetUsedClient",isUsedClientCAMark:"safetyVerifyFlashCallIsUsedClient",isRemClientCAMark:"safetyVerifyFlashCallIsRemClient"};if(e&&(n=t[e.jsKey])){if(window.safetyVerifyUtil)return safetyVerifyUtil[n](e);$.getScript("https://res.udb.duowan.com/ca/js/extra/sdk/pcweb.js",function(){$.getScript("//a.msstatic.com/huya/icenter/2.0/js/safety-verify.js",function(){return safetyVerifyUtil[n](e)})})}}var t=e("TTP"),o=e("TTR"),i=e("TTA"),a=e("tools");if(t.on("displayModeChange",function(e){var n=$("body");0==e?n.removeClass("mode-page-full"):1==e&&n.addClass("mode-page-full")}),e("chatRoom"),e("chat"),e("chatTab"),e("anchorStore"),document.getElementById("J-weekRank")){var s=e("rankTab");e("week_rank"),e("fans_rank");var c=a.once(function(){e.async("widget/salt_rank")});$(window).on("load",c),setTimeout(c,1e4),2===s.getIndex()?c():s.change(function(e){2===e&&c()})}o.isOn&&e("vipList"),e("widget/fansbadge");var u=e("noble");e("input_ob"),e("hideshare"),e("share"),o.isOn&&($(window).on("load",function(){e.async("widget/illegalReport")}),$(".illegal-report").on("click",function(){NAV_UTIL.checkLogin(function(){e.async("widget/illegalReport",function(e){e()})})})),e.async("jumpToPhone"),e("widget/game_promote"),e("widget/game_buy"),e("treasureChest"),e("videoScale"),e.async("gift"),e.async("chatEmot"),e.async("activity"),e("widget/userLevel");var r=1e4,f=function(n){"function"!=typeof n&&(n=function(){});(6==o.liveSourceType&&0==o.screenType||2==o.liveSourceType)&&2168==o.gid;e.async("widget/weekStar",n)};$(window).on("load",f),setTimeout(f,r),t.on("showWeekStarRank",function(){f(function(e){e()})});var l=function(n){"function"!=typeof n&&(n=function(){}),e.async("guessReport",n)};$(window).on("load",l),setTimeout(l,r),t.on(t.isH5?"guessReport":"gameGuessReport",function(){l(function(e){e()})});var d=function(n){"function"!=typeof n&&(n=function(){}),e.async("getPrize",n)};$(window).on("load",d),setTimeout(d,r),t.isH5?t.ready(function(e){e.addTafListener("7054",function(e){d(function(n){n({param:e})})})}):t.on("showRaffleWinnerNotice",function(e){d(function(n){n(e)})});var y=function(n){"function"!=typeof n&&(n=function(){}),e.async("widget/recharge",n)};$(window).on("load",y),setTimeout(y,r),t.on("webgamepaylayer",function(e){y(function(n){n(e)})}),TT.on("liveRoom_recharge",function(e,n){y(function(e){e(n)})});var p=function(n){"function"!=typeof n&&(n=function(){}),e.async("topUpPayment",n)};$(window).on("load",p),setTimeout(p,r),t.on("topUpPayment",function(e){p(function(n){n(e)})});var m=function(n){"function"!=typeof n&&(n=function(){}),e.async("firstRecharge",n)};$(window).on("load",m),setTimeout(m,r),t.on("getFirstRecharge",function(e){m(function(n){n(e)})}),t.ready(function(){e.async("watchHistory")});var h=e("getCreatelayer"),g=null;$(".open-souhu").on("click",function(){NAV_UTIL.checkLogin(function(){h(function(e){g?g.show():g=new e({title:"\u5b88\u62a4\u7cfb\u7edf",width:670,height:450,url:"//hd.huya.com/guardOpen/index.html?uid="+i.lp+"&type=2&channelId="+o.id+"&gameid="+o.gid,idDom:"souhuLayer",idMask:"souhuMask"})})})}),$(".open-guizu").on("click",function(e){e.preventDefault(),u.open()}),t.on("showSafetyVerifyPopupBox",n),t.on("closeSafetyVerifyPopupBox",n),t.on("setUsedClientCAMark",n),t.on("isUsedClientCAMark",n),t.on("isRemClientCAMark",n),t.on("webgamelivepay",function(e){if(window.pay_util)return pay_util.execute(e);var n=document.createElement("link");n.rel="stylesheet",n.href="https://res.duowan.com/pay/auth/web/style.css",document.getElementsByTagName("head")[0].appendChild(n),$.getScript("//res.duowan.com/pay/auth/js/auth.js",function(){var n="//a.msstatic.com/huya/main/js/livepay_4c86cde.js";$.getScript(n,function(){return pay_util.execute(e)})})}),t.on("setGuid",function(e){var n=new Date;n.setTime(n.getTime()+2592e6),HUYA_UTIL.writeCookie("guid",e.param.guid,TT.domainForWriteCookie,"/",n)}),t.on("webgamelivelogin",NAV_UTIL.login),t.isFlash&&t.on("setFlashCookie",function(e){var n=new Date;n.setTime(n.getTime()+864e5),HUYA_UTIL.writeCookie(e.param.cookieKey,e.param.cookieVal,TT.domainForWriteCookie,"/",n)});var w=e("formatNumber");!function(){function e(e){var n=e.param?e.param.data.total_count:e.data.total_count;if(n>0){var t=w.formatNumber2(n,"#,###");$("#live-count").html(t)}}t.isH5?t.ready(function(n){n.addTafListener("8006",function(n){e({data:{total_count:n.iAttendeeCount}})})}):t.on("WebTotalCount",e)}(),function(){function e(e){var n=e.param?e.param:e;$("#activityCount").text(n.data?n.data.iToCount:n.iToCount)}t.isH5?t.ready(function(n){n.addTafListener("3104",e)}):t.on("subscribeInfoNotice",e)}(),function(){function e(){$(".notice-live").show()}t.isH5?t.ready(function(n){n.addTafListener("9010",e)}):t.on("noticeLive",e)}(),t.on("liveStatusChange",function(e){var n=e.param?e.param.status:e.status;TT.emit("liveStatusChange",n)}),t.isFlash&&t.on("isUserOnLive",function(e){1==e.param.isLive&&$("#tipsOrchat").css("visibility","visible").html('<div class="live-tips"><i></i><p>\u4e3a\u4fdd\u969c\u60a8\u7684\u76f4\u64ad\u4e0d\u88ab\u4e2d\u65ad\uff0c\u60a8\u6682\u65f6\u4e0d\u80fd\u5728\u7f51\u9875\u4e0a\u8fdb\u884c\u7ade\u731c\uff0c\u9001\u793c\u548c\u53d1\u8a00(\u76f4\u5230\u60a8\u7ed3\u675f\u76f4\u64ad),\u6211\u4eec\u5c06\u5c3d\u5feb\u89e3\u51b3\u3002</p></div>')}),t.isFlash&&$(window).on("focus",function(){t.ready()&&t.call("changeTabTarget")}),t.ready(function(e){t.isFlash?t.on("getUserNovieTaskCompleteRsp",function(){TT.emit("userLevelTaskComplete")}):e.addTafListener("1000107",function(){TT.emit("userLevelTaskComplete")})})});